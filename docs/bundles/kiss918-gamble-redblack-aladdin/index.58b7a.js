window.__require=function t(e,i,n){function s(o,l){if(!i[o]){if(!e[o]){var r=o.split("/"),d=r,c=o;if(d=d[d.length-1],r.length>1&&(window.cachePath[d]=o),!e[d]){var u="function"==typeof __require&&__require;if(!l&&u)return u(d,!0);if(a)return a(d,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){var h=window.cachePath[d];h&&(c=h);for(var p=c.split("/"),f="",g=p.length;g>0;)p[g]&&".."!=p[g]&&(f="/"+p[g]+f),g--;return d="./assets"+f,__quick_compile_project__.require(d,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+o+"'")}o=d}var m=i[o]={exports:{}};e[o][0].call(m.exports,function(t){return s(e[o][1][t]||t)},m,m.exports,t,e,i,n)}return i[o].exports}window.cachePath={};for(var a="function"==typeof __require&&__require,o=0;o<n.length;o++)s(n[o]);return s}({Kiss918RedBlackPanelEnum_AD:[function(t,e,i){"use strict";cc._RF.push(e,"ae62fJQl+RCKakdeBtT0e7I","Kiss918RedBlackPanelEnum_AD"),Object.defineProperty(i,"__esModule",{value:!0}),i.Kiss918Choices_AD=void 0,function(t){t[t.Red=1]="Red",t[t.Black=2]="Black"}(i.Kiss918Choices_AD||(i.Kiss918Choices_AD={})),cc._RF.pop()},{}],Kiss918RedBlackPanelEvent_AD:[function(t,e){"use strict";cc._RF.push(e,"9c579nAfnhGpZsbtnEZ4Br2","Kiss918RedBlackPanelEvent_AD"),cc._RF.pop()},{}],Kiss918RedBlackPanelModel_AD:[function(t,e,i){"use strict";cc._RF.push(e,"6087dOd6/RNJaaHgjVFRt/b","Kiss918RedBlackPanelModel_AD"),Object.defineProperty(i,"__esModule",{value:!0}),i.Kiss918RedBlackPanelModel_AD=void 0,i.Kiss918RedBlackPanelModel_AD=class{constructor(){this.redBlackActive=!1,this.redBlackResult=null,this.lastCardResults=[]}},cc._RF.pop()},{}],Kiss918RedBlackPanelModule_AD:[function(t,e,i){"use strict";cc._RF.push(e,"de441C21Q9IOYl06rWbVBZR","Kiss918RedBlackPanelModule_AD");var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{r(n.next(t))}catch(e){a(e)}}function l(t){try{r(n.throw(t))}catch(e){a(e)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,l)}r((n=n.apply(t,e||[])).next())})};Object.defineProperty(i,"__esModule",{value:!0});const s=t("../../../../../../scripts/HelperTools"),a=t("./Kiss918RedBlackPanelEnum_AD"),o=t("./Kiss918RedBlackPanelModel_AD");class l extends cc.Component{static init(){this.data=new o.Kiss918RedBlackPanelModel_AD}static getRedBlackPanelStatus(){return this.data.redBlackActive}static setRedBlackPanelStatus(t){this.data.redBlackActive=t}static setRedBlackResult(t){this.data.redBlackResult=t}static getLastCardsResults(){return this.data.lastCardResults}static clearRedBlackResult(){this.data.redBlackResult=null,this.data.lastCardResults=[]}static getRedBlackResult(t,e){return n(this,void 0,void 0,function*(){return new Promise(i=>{const n=s.GetRandomInterger(1,52),o=n<=26?a.Kiss918Choices_AD.Red:a.Kiss918Choices_AD.Black;let l=0;t===o&&(l=2*e);const r={cardResult:n,winAmount:l/2,playerBalance:l};this.setRedBlackResult(r),this.addLastCardResult(r.cardResult),i(r)})})}static addLastCardResult(t){this.data.lastCardResults.length>=5&&this.data.lastCardResults.shift(),this.data.lastCardResults.push(t)}}i.default=l,l.data=null,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"./Kiss918RedBlackPanelEnum_AD":"Kiss918RedBlackPanelEnum_AD","./Kiss918RedBlackPanelModel_AD":"Kiss918RedBlackPanelModel_AD"}],Kiss918RedBlackPanelPrefab_AD:[function(t,e,i){"use strict";cc._RF.push(e,"3153f8lZd1Hw5kbanQ8udh6","Kiss918RedBlackPanelPrefab_AD");var n=this&&this.__decorate||function(t,e,i,n){var s,a=arguments.length,o=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(o=(a<3?s(o):a>3?s(e,i,o):s(e,i))||o);return a>3&&o&&Object.defineProperty(e,i,o),o},s=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{r(n.next(t))}catch(e){a(e)}}function l(t){try{r(n.throw(t))}catch(e){a(e)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,l)}r((n=n.apply(t,e||[])).next())})},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0});const o=t("../../../../../../scripts/framework/gg"),l=t("../../../../../../scripts/HelperTools"),r=a(t("../../../../../../scripts/manager/AudioManager")),d=t("../../../../../../scripts/manager/CreditCoinConvertorManager"),c=a(t("../../../../../../scripts/manager/GameSystemManager")),u=t("./Kiss918RedBlackPanelEnum_AD"),h=a(t("./Kiss918RedBlackPanelModule_AD")),{ccclass:p,property:f}=cc._decorator;let g=class extends cc.Component{constructor(){super(...arguments),this.redBlackGroup=null,this.buttonGroup=null,this.messageGroup=null,this.labelGroup=null,this.currentResult=null,this.lastResults=null,this.cardAtlas=null,this.effectGroup=null,this.fireAnims=[],this.hasSpriteLocalise=!0,this.mainSpriteAtlas=null,this.btnRed=null,this.btnBlack=null,this.btnCollect=null,this.spriteChooseRedOrBlack=null,this.spriteYouWin=null,this.spriteDealerWin=null,this.spriteBank=null,this.spriteDoubleTo=null,this.spriteWinAmount=null,this.labelBank=null,this.labelDoubleTo=null,this.labelWinAmount=null,this.playerInfoManager={factorValue:0,played:!1},this.betInfoManager={win:0,bet:0,double:0},this.audioInfo={genClick:"Sfx_ButtonClicks",bgm:"Sfx_Gamble_BGM",idleAnim:"Sfx_Gamble_Shine",pick:"Sfx_Gamble_Card_Flip",win:"",lose:""},this.idleGroup=null,this.winEffectAnim=null,this.pickedRed=()=>s(this,void 0,void 0,function*(){this.playCardClickSFX(),this.handleButtonsInteraction(!1),this.enableTargetNode(this.btnCollect,!1),this.showTargetIdle(0);const t=yield this.getRedBlackResult(u.Kiss918Choices_AD.Red);this.showResult(t)}),this.pickedBlack=()=>s(this,void 0,void 0,function*(){this.playCardClickSFX(),this.handleButtonsInteraction(!1),this.enableTargetNode(this.btnCollect,!1),this.showTargetIdle(1);const t=yield this.getRedBlackResult(u.Kiss918Choices_AD.Black);this.showResult(t)}),this.collectMoney=()=>{this.playAudio(this.audioInfo.genClick),this.inActiveRedBlackPanel()},this.onReceiveWinAmountUpdateEvent=t=>{if(this.reseETlayerInfoManager(),this.resetBetInfoManager(),-1===t){const t=5;this.updateBetInfoManager(0,t)}else this.updateBetInfoManager(0,t)},this.hideGambleButton=()=>{o.gg.eventManager.emit("GambleButton.Hide")},this.tweenAct=null}onLoad(){this.registerEvent(),this.setupProperty()}start(){return s(this,void 0,void 0,function*(){this.setupRedBlackModule(),yield this.loadRedBlackAssets()})}activeGamblePanel(){this.clearUpPreviousPresentation(),h.default.setRedBlackPanelStatus(!0),this.redBlackGroup.active=!0,this.playAudio(this.audioInfo.bgm,!0),this.fireAnims.forEach(t=>{t.play()}),this.resetBettingUI(),this.enableTargetNode(this.btnCollect,!0),this.handleButtonsInteraction(!0),this.updateLastCardsResult(),this.playIdleAnimation()}inActiveRedBlackPanel(){this.stopCardResultAnimation(),this.stopIdleAnimation(),this.handleButtonsInteraction(!1),this.stopAudio(this.audioInfo.bgm),this.fireAnims.forEach(t=>{t.stop()}),o.gg.eventManager.emit("GamblePanel.OnComplete",this.finalWinAmount),h.default.setRedBlackPanelStatus(!1),this.redBlackGroup.active=!1}showResult(t){return s(this,void 0,void 0,function*(){const e=t.winAmount>0;yield this.playCardResultAnimation(),this.updatePlayerInfoManager(t.winAmount),e&&this.updateBetInfoManager(t.winAmount,2*t.winAmount),this.labelBank.string=d.CCConvertor(t.winAmount.toString()),this.updateBettingLabelResult(t),this.updateCurrentCardsResult(t.cardResult),this.updateLastCardsResult(),e&&(yield this.playWinEffectAnimation()),yield l.Delay(2),this.resetBettingUI(),e?(this.playIdleAnimation(),this.enableTargetNode(this.btnCollect,!0),this.handleButtonsInteraction(!0)):(this.stopCardResultAnimation(),this.inActiveRedBlackPanel())})}getRedBlackResult(t){return h.default.getRedBlackResult(t,this.betAmount)}clearUpPreviousPresentation(){o.gg.eventManager.emit("HUDPrefab.onWiningLineAndSymbolClear"),r.default.getInstance().stopAll(),this.playAudio(this.audioInfo.genClick)}get factorValue(){return this.playerInfoManager.factorValue}get finalWinAmount(){return this.playerInfoManager.played?this.betAmount*this.factorValue:0}updatePlayerInfoManager(t){this.playerInfoManager.played=!0,this.playerInfoManager.factorValue=t>0?1:-1}reseETlayerInfoManager(){this.playerInfoManager={factorValue:1,played:!1}}get betWinAmount(){return this.betInfoManager.win}get betAmount(){return this.betInfoManager.bet}get doubleBetAmount(){return this.betInfoManager.double}updateBetInfoManager(t,e){this.betInfoManager.win+=t,this.betInfoManager.bet=e,this.betInfoManager.double=2*e}resetBetInfoManager(){this.betInfoManager={win:0,bet:0,double:0}}updateBettingLabelResult(t){t.winAmount>0?(this.updateBettingInfomation(),this.enableTargetNode(this.spriteChooseRedOrBlack,!0),this.enableTargetNode(this.spriteYouWin,!0),this.enableTargetNode(this.spriteDealerWin,!1),this.enableTargetNode(this.labelWinAmount,!0),this.playAudio(this.audioInfo.win)):(this.enableTargetNode(this.spriteChooseRedOrBlack,!0),this.enableTargetNode(this.spriteYouWin,!1),this.enableTargetNode(this.spriteDealerWin,!0),this.enableTargetNode(this.labelWinAmount,!1),this.playAudio(this.audioInfo.lose))}updateBettingInfomation(){this.labelWinAmount&&(this.labelWinAmount.string=d.CCConvertor(this.betWinAmount.toFixed(2))),this.labelBank&&(this.labelBank.string=d.CCConvertor(this.betAmount.toFixed(2))),this.labelDoubleTo&&(this.labelDoubleTo.string=d.CCConvertor(this.doubleBetAmount.toFixed(2)))}resetBettingUI(){this.enableTargetNode(this.spriteChooseRedOrBlack,!0),this.enableTargetNode(this.spriteYouWin,!1),this.enableTargetNode(this.spriteDealerWin,!1),this.enableTargetNode(this.labelBank,!0),this.enableTargetNode(this.labelDoubleTo,!0),this.enableTargetNode(this.labelWinAmount,!1),this.updateBettingInfomation(),this.stopCardResultAnimation(),this.stopIdleAnimation(),this.stopWinEffectAnimation()}handleButtonsInteraction(t){this.btnRed.interactable=t,this.btnRed.enabled=t,this.btnBlack.interactable=t,this.btnBlack.enabled=t,this.btnCollect.interactable=t,this.btnCollect.enabled=t}enableTargetNode(t,e){t&&(t.node.active=e)}updateLastCardsResult(){const t=h.default.getLastCardsResults();for(let e=0,i=t.length;e<i;e++){const i=this.lastResults.children[e],n=t[e],s=this.getCardSpriteFrame(n);i.active=!0,i.getComponent(cc.Sprite).spriteFrame=s.smallCard}}updateCurrentCardsResult(t){this.stopCardResultAnimation();const e=this.getCardSpriteFrame(t);this.currentResult.spriteFrame=e.bigCard}getCardSpriteFrame(t){const e=t<27?"GenieMin":"AladdinMin",i=t<27?"WinGenie":"WinAladdin";return{smallCard:this.cardAtlas.getSpriteFrame(e),bigCard:this.cardAtlas.getSpriteFrame(i)}}playCardResultAnimation(){return s(this,void 0,void 0,function*(){const t=this.currentResult.getComponent(cc.Animation).play();yield l.Delay(t.duration)})}stopCardResultAnimation(){this.currentResult.spriteFrame=this.cardAtlas.getSpriteFrame("Poker_01"),this.currentResult.getComponent(cc.Animation).stop()}playIdleAnimation(){this.idleGroup.active=!0,this.idleGroup.children[0].active=!1,this.idleGroup.children[1].active=!1,this.tweenAct=cc.tween(this.idleGroup).call(()=>{this.idleGroup.children[0].active=!0,this.idleGroup.children[1].active=!1,this.playAudio(this.audioInfo.idleAnim)}).delay(1).call(()=>{this.idleGroup.children[0].active=!1,this.idleGroup.children[1].active=!0,this.playAudio(this.audioInfo.idleAnim)}).delay(1),cc.tween(this.idleGroup).repeatForever(this.tweenAct).start()}showTargetIdle(t){this.stopIdleAnimation(),this.idleGroup.active=!0,this.idleGroup.children[t].active=!0}stopIdleAnimation(){this.tweenAct&&cc.tween(this.idleGroup).repeatForever(this.tweenAct).stop(),cc.Tween.stopAllByTarget(this.idleGroup),this.idleGroup.active=!1,this.stopAudio(this.audioInfo.idleAnim),this.idleGroup.children.forEach(t=>{t.active=!1})}playWinEffectAnimation(){return s(this,void 0,void 0,function*(){const t=this.winEffectAnim.play();yield l.Delay(t.duration)})}stopWinEffectAnimation(){this.winEffectAnim.stop(),this.winEffectAnim.node.getComponent(cc.Sprite).spriteFrame=null}playCardClickSFX(){this.playAudio(this.audioInfo.pick?this.audioInfo.pick:this.audioInfo.genClick)}playAudio(t,e=!1){t&&r.default.getInstance().play(t,e)}stopAudio(t){t&&r.default.getInstance().stop(t)}registerEvent(){o.gg.eventManager.on("HUDPrefab.onWiningLineAndSymbolClear",this.hideGambleButton,this),o.gg.eventManager.on("SlotEnginePrefab.OnSpinStarted",this.hideGambleButton,this),o.gg.eventManager.on("SlotEnginePrefab.OnSpinStartedByReel",this.hideGambleButton,this),o.gg.eventManager.on("GamblePanel.OnUpdateStartingAmount",this.onReceiveWinAmountUpdateEvent,this),o.gg.eventManager.on("GamblePanel.OnStart",this.activeGamblePanel,this)}setupRedBlackModule(){h.default.init()}setupProperty(){this.assignUINode(),this.registerButtonEvent(),this.redBlackGroup.active&&(this.redBlackGroup.active=!1),this.idleGroup=this.getChildNode("Idle",this.effectGroup),this.winEffectAnim=this.getChildNode("Win",this.effectGroup).getComponentInChildren(cc.Animation)}assignUINode(){var t;this.labelBank=null===(t=this.getChildNode("LabelBank",this.labelGroup))||void 0===t?void 0:t.getComponent(cc.Label),this.btnRed=this.getChildNode("BtnRed",this.buttonGroup).getComponent(cc.Button),this.btnBlack=this.getChildNode("BtnBlack",this.buttonGroup).getComponent(cc.Button),this.btnCollect=this.getChildNode("BtnCollect",this.buttonGroup).getComponent(cc.Button)}registerButtonEvent(){this.btnRed.node.on("click",this.pickedRed),this.btnBlack.node.on("click",this.pickedBlack),this.btnCollect.node.on("click",this.collectMoney)}getChildNode(t,e){return e.getChildByName(t)}changeSpriteFrame(t,e){const i=this.mainSpriteAtlas.getSpriteFrame(e);t&&i&&(t.spriteFrame=i)}changeButtonSprite(t,e){t&&l.UItools.ChangeButtonSpriteFrame(t,this.mainSpriteAtlas,{normalSprite:e+"_01",pressedSprite:e+"_02",disabledSprite:e+"_03"})}getAllAudioPath(){const t=[];return this.audioInfo.bgm&&t.push("common/sounds/"+this.audioInfo.bgm),this.audioInfo.pick&&t.push("common/sounds/"+this.audioInfo.pick),this.audioInfo.idleAnim&&t.push("common/sounds/"+this.audioInfo.idleAnim),this.audioInfo.win&&t.push("common/sounds/"+this.audioInfo.win),this.audioInfo.lose&&t.push("common/sounds/"+this.audioInfo.lose),t}loadRedBlackAssets(){return s(this,void 0,void 0,function*(){return new Promise(t=>{cc.assetManager.loadBundle("kiss918-gamble-redblack-aladdin",(e,i)=>{if(e)return console.error(e);const n=c.default.getInstance().getLanguageCode(),a=l.AsyncTask(t=>s(this,void 0,void 0,function*(){if(this.hasSpriteLocalise){const t="textures/"+n+"/GambleUI";i.load(t,cc.SpriteAtlas,(t,e)=>{t&&console.error(t),this.mainSpriteAtlas=e,this.changeButtonSprite(this.btnCollect,"BtnTake")})}i.load(this.getAllAudioPath(),cc.AudioClip,(t,e)=>{t&&console.error(t);for(const i of e)r.default.getInstance().add(i.name,i)}),t()}));Promise.all([a]).then(()=>{t()})})})})}};n([f(cc.Node)],g.prototype,"redBlackGroup",void 0),n([f(cc.Node)],g.prototype,"buttonGroup",void 0),n([f(cc.Node)],g.prototype,"messageGroup",void 0),n([f(cc.Node)],g.prototype,"labelGroup",void 0),n([f(cc.Sprite)],g.prototype,"currentResult",void 0),n([f(cc.Node)],g.prototype,"lastResults",void 0),n([f(cc.SpriteAtlas)],g.prototype,"cardAtlas",void 0),n([f(cc.Node)],g.prototype,"effectGroup",void 0),n([f(cc.Animation)],g.prototype,"fireAnims",void 0),n([f()],g.prototype,"hasSpriteLocalise",void 0),g=n([p],g),i.default=g,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"../../../../../../scripts/framework/gg":void 0,"../../../../../../scripts/manager/AudioManager":void 0,"../../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../../scripts/manager/GameSystemManager":void 0,"./Kiss918RedBlackPanelEnum_AD":"Kiss918RedBlackPanelEnum_AD","./Kiss918RedBlackPanelModule_AD":"Kiss918RedBlackPanelModule_AD"}]},{},["Kiss918RedBlackPanelEnum_AD","Kiss918RedBlackPanelEvent_AD","Kiss918RedBlackPanelModel_AD","Kiss918RedBlackPanelModule_AD","Kiss918RedBlackPanelPrefab_AD"]);