window.__require=function t(n,e,o){function a(c,r){if(!e[c]){if(!n[c]){var p=c.split("/");if(p=p[p.length-1],!n[p]){var s="function"==typeof __require&&__require;if(!r&&s)return s(p,!0);if(i)return i(p,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){for(var l=c.split("/"),m="",u=l.length;u>0;)l[u]&&".."!=l[u]&&(m="/"+l[u]+m),u--;return p="./assets"+m,__quick_compile_project__.require(p,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+c+"'")}c=p}var d=e[c]={exports:{}};n[c][0].call(d.exports,function(t){return a(n[c][1][t]||t)},d,d.exports,t,n,e,o)}return e[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<o.length;c++)a(o[c]);return a}({JackpotCoinRainPrefab:[function(t,n,e){"use strict";cc._RF.push(n,"06cea7QAMpMM5mWoFX5oEiz","JackpotCoinRainPrefab");var o=this&&this.__decorate||function(t,n,e,o){var a,i=arguments.length,c=i<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,e,o);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(c=(i<3?a(c):i>3?a(n,e,c):a(n,e))||c);return i>3&&c&&Object.defineProperty(n,e,c),c};Object.defineProperty(e,"__esModule",{value:!0});const{ccclass:a,property:i}=cc._decorator;let c=class extends cc.Component{constructor(){super(...arguments),this.coinParticleAnimationName="",this.main={coinParticle:null,coinParticleAnimation:null}}onLoad(){this.cacheCoinRainPorperty()}start(){}onEnable(){this.playCoinSpreadAnimation()}onDisable(){this.stopCoinSpreadAnimation()}cacheCoinRainPorperty(){this.main.coinParticle=this.node.getComponent(cc.ParticleSystem),this.main.coinParticleAnimation=this.node.getComponent(cc.Animation)}playCoinSpreadAnimation(){this.coinParticleAnimationName&&this.main.coinParticleAnimation.play(this.coinParticleAnimationName)}stopCoinSpreadAnimation(){this.coinParticleAnimationName&&this.main.coinParticleAnimation.stop(),this.main.coinParticle.resetSystem()}};o([i],c.prototype,"coinParticleAnimationName",void 0),c=o([a],c),e.default=c,cc._RF.pop()},{}],JackpotPanelConst:[function(t,n,e){"use strict";cc._RF.push(n,"da1fak31FtOYZxetpVOeohU","JackpotPanelConst"),Object.defineProperty(e,"__esModule",{value:!0}),e.JackpotPanelConst=void 0,e.JackpotPanelConst={CacheKey:"game.cache"},cc._RF.pop()},{}],JackpotPanelEnum:[function(t,n,e){"use strict";cc._RF.push(n,"446c73nmCNDkYTSD+8a+ZNM","JackpotPanelEnum"),Object.defineProperty(e,"__esModule",{value:!0}),e.JackpotType=void 0,function(t){t[t.Minor=1]="Minor",t[t.Random=2]="Random",t[t.Major=3]="Major"}(e.JackpotType||(e.JackpotType={})),cc._RF.pop()},{}],JackpotPanelEvent:[function(t,n,e){"use strict";cc._RF.push(n,"ec8aaWbXDpBU7Tl8BZe3jX5","JackpotPanelEvent"),Object.defineProperty(e,"__esModule",{value:!0}),e.JackporPanelEvent=void 0,(e.JackporPanelEvent||(e.JackporPanelEvent={})).OnJackpotWon="JackporPanelEvent.OnJackpotWon",cc._RF.pop()},{}],JackpotPanelModel:[function(t,n,e){"use strict";cc._RF.push(n,"cda54LE0HFCGL9KzYVtVHnJ","JackpotPanelModel"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.jackpotCounterAmount={major:0,random:0,minor:0},this.jackpoWonResult=null}},cc._RF.pop()},{}],JackpotPanelModule:[function(t,n,e){"use strict";cc._RF.push(n,"f5c9dc6EqBFSKT+55fVn0JE","JackpotPanelModule");var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=t("../../../../scripts/HelperTools"),i=t("./JackpotPanelEnum"),c=o(t("./JackpotPanelModel"));class r extends cc.Component{static getJackpotPanelModule(){return this}static getJackpotAmount(t){let n=0;switch(t){case i.JackpotType.Major:n=a.GetRandomFloat(2e4,25e4),this.data.jackpotCounterAmount.major=n;break;case i.JackpotType.Random:n=this.data.jackpotCounterAmount.random+a.GetRandomFloat(.1,.9),this.data.jackpotCounterAmount.random=n;break;case i.JackpotType.Minor:n=a.GetRandomFloat(5e3,6e4),this.data.jackpotCounterAmount.minor=n}return n}static setJackpoWonResult(t){this.data.jackpoWonResult=t}static init(){this.data=new c.default,this.data.jackpotCounterAmount.minor=0,this.data.jackpotCounterAmount.random=a.GetRandomFloat(23e4,11e5),this.data.jackpotCounterAmount.major=0}static saveSettingConfig(){}}e.default=r,r.data=null,cc._RF.pop()},{"../../../../scripts/HelperTools":void 0,"./JackpotPanelEnum":"JackpotPanelEnum","./JackpotPanelModel":"JackpotPanelModel"}],JackpotPanelPrefab:[function(t,n,e){"use strict";cc._RF.push(n,"1b581ER5aNL/oJKkK70wU6n","JackpotPanelPrefab");var o=this&&this.__createBinding||(Object.create?function(t,n,e,o){void 0===o&&(o=e),Object.defineProperty(t,o,{enumerable:!0,get:function(){return n[e]}})}:function(t,n,e,o){void 0===o&&(o=e),t[o]=n[e]}),a=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),i=this&&this.__decorate||function(t,n,e,o){var a,i=arguments.length,c=i<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,e,o);else for(var r=t.length-1;r>=0;r--)(a=t[r])&&(c=(i<3?a(c):i>3?a(n,e,c):a(n,e))||c);return i>3&&c&&Object.defineProperty(n,e,c),c},c=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&o(n,t,e);return a(n,t),n},r=this&&this.__awaiter||function(t,n,e,o){return new(e||(e=Promise))(function(a,i){function c(t){try{p(o.next(t))}catch(n){i(n)}}function r(t){try{p(o.throw(t))}catch(n){i(n)}}function p(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(c,r)}p((o=o.apply(t,n||[])).next())})},p=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=t("../../../../scripts/framework/gg"),l=t("../../../../scripts/framework/lib/router/PanelComponent"),m=t("../../../../scripts/HelperTools"),u=p(t("../../../../scripts/manager/AudioManager")),d=c(t("../../../../scripts/manager/CreditCoinConvertorManager")),k=p(t("../../../../scripts/manager/EventQueueManager")),h=p(t("../../../../scripts/manager/GameSystemManager")),J=t("./JackpotPanelEnum"),f=p(t("./JackpotPanelModule")),{ccclass:g,property:P}=cc._decorator;let v=class extends l.PanelComponent{constructor(){super(...arguments),this.jackpotWiningPanel=null,this.labelJackpotWiningPanelAmount=null,this.jackpotWiningBg=null,this.minorJackpotAnimation=null,this.randomJackpotAnimation=null,this.majorJackpotAnimation=null,this.coinRainPrefab01=null,this.minJackpotAnimTime=10,this.maxJackpotAnimTime=30,this.cacheAnimation=null}onLoad(){this.registerEvent()}start(){return r(this,void 0,void 0,function*(){yield this.loadJackpotAssets(),this.setupJackpotModule()})}show(t){t.onShowed()}hide(t){t.onHided()}triggerJackpot(){f.default.setJackpoWonResult({jackpotType:J.JackpotType.Major,amount:1e3}),s.gg.eventManager.emit("JackporPanelEvent.OnJackpotWon"),cc.find("SafeArea/BtnTriggerJackpot",this.node).active=!1}registerEvent(){s.gg.eventManager.on("JackporPanelEvent.OnJackpotWon",this.onStartJackpotWonAnimation,this)}setupJackpotModule(){return r(this,void 0,void 0,function*(){f.default.init(),this.addLabelForCreditCoinUpdate()})}addLabelForCreditCoinUpdate(){d.default.getInstance().addLabelSprite(this.labelJackpotWiningPanelAmount)}onStartJackpotWonAnimation(){return r(this,void 0,void 0,function*(){f.default.data.jackpoWonResult&&(this.coinRainPrefab01.active=!0,this.jackpotAnimStateMachine=this.createjackpotAnimStateMachine(),yield this.jackpotAnimStateMachine.showJackpotWon(),yield this.jackpotAnimStateMachine.countingBalance(),yield this.jackpotAnimStateMachine.hideJackpotWin(),this.coinRainPrefab01.active=!1,f.default.data.jackpoWonResult=null,this.jackpotAnimStateMachine=null)})}createjackpotAnimStateMachine(){return new StateMachine({init:"idle",transitions:[{name:"showJackpotWon",from:"idle",to:"showWining"},{name:"countingBalance",from:"showWining",to:"showCounting"},{name:"hideJackpotWin",from:"showCounting",to:"idle"}],methods:{onShowJackpotWon:()=>this.onShowJackpotWon(),onCountingBalance:()=>this.onCountingBalance(),onHideJackpotWin:()=>this.onHideJackpotWon()}})}onShowJackpotWon(){return r(this,void 0,void 0,function*(){switch(u.default.getInstance().play("JackpotWinningBGM",!0),f.default.data.jackpoWonResult.jackpotType){case J.JackpotType.Major:this.cacheAnimation=this.majorJackpotAnimation.getComponent(cc.Animation),this.cacheAnimation.play("MajorJackpotAnim"),this.majorJackpotAnimation.node.active=!0;break;case J.JackpotType.Random:this.cacheAnimation=this.randomJackpotAnimation.getComponent(cc.Animation),this.cacheAnimation.play("RandomJackpotAnim"),this.randomJackpotAnimation.node.active=!0;break;case J.JackpotType.Minor:this.cacheAnimation=this.minorJackpotAnimation.getComponent(cc.Animation),this.cacheAnimation.play("MinorJackpotAnim"),this.minorJackpotAnimation.node.active=!0}this.labelJackpotWiningPanelAmount.string=d.CCConvertor(f.default.data.jackpoWonResult.amount.toFixed(2)),this.jackpotWiningPanel.opacity=0,this.jackpotWiningPanel.active=!0,cc.tween(this.jackpotWiningPanel).to(1,{opacity:255},{easing:"sineOut"}).call(()=>{const t=cc.tween().to(.25,{opacity:0}).delay(.25).to(.25,{opacity:255}).delay(1.5);cc.tween(this.jackpotWiningPanel).repeatForever(t).start()}).start()})}onCountingBalance(){return r(this,void 0,void 0,function*(){const t=d.CCConvertor(f.default.data.jackpoWonResult.amount.toFixed(2));let n=J.JackpotType.Major;switch(f.default.data.jackpoWonResult.jackpotType){case J.JackpotType.Major:n=J.JackpotType.Major;break;case J.JackpotType.Random:n=J.JackpotType.Random;break;case J.JackpotType.Minor:n=J.JackpotType.Minor}s.gg.eventManager.emit("JackporPanelEvent.UpdateJackpotProgression",{type:n,jackpotWonAmount:t,maxJackpotAnimTime:this.maxJackpotAnimTime}),k.default.getInstance().addEvent("SpaceOrSpinButton","ShowJackpotAnim",()=>{s.gg.eventManager.emit("JackpotWinAnim.OnSpaceOrSpinButtonDown")}),s.gg.eventManager.emit("HUDPrefab.OnSpinButtonUpdate","disable"),yield m.Delay(this.minJackpotAnimTime),s.gg.eventManager.emit("HUDPrefab.OnSpinButtonUpdate","enable"),yield m.SkippableDelay(this.maxJackpotAnimTime-this.minJackpotAnimTime,"JackpotWinAnim.OnSpaceOrSpinButtonDown"),k.default.getInstance().removeEventById("SpaceOrSpinButton","ShowJackpotAnim")})}onHideJackpotWon(){return r(this,void 0,void 0,function*(){this.cacheAnimation.stop(),this.cacheAnimation=null,this.minorJackpotAnimation.node.active=!1,this.randomJackpotAnimation.node.active=!1,this.majorJackpotAnimation.node.active=!1,cc.Tween.stopAllByTarget(this.jackpotWiningPanel),yield m.AsyncTask(t=>r(this,void 0,void 0,function*(){cc.tween(this.jackpotWiningPanel).to(1,{opacity:0},{easing:"sineOut"}).call(()=>{this.labelJackpotWiningPanelAmount.string="0",this.jackpotWiningPanel.active=!1,u.default.getInstance().stop("JackpotWinningBGM"),t()}).start()})),this.resetJackpotWonCounter(),cc.find("SafeArea/BtnTriggerJackpot",this.node).active=!0})}resetJackpotWonCounter(){switch(f.default.data.jackpoWonResult.jackpotType){case J.JackpotType.Major:s.gg.eventManager.emit("JackporPanelEvent.ResetJackpotProgression",J.JackpotType.Major);break;case J.JackpotType.Random:s.gg.eventManager.emit("JackporPanelEvent.ResetJackpotProgression",J.JackpotType.Random);break;case J.JackpotType.Minor:s.gg.eventManager.emit("JackporPanelEvent.ResetJackpotProgression",J.JackpotType.Minor)}}loadJackpotAssets(){return new Promise(t=>{cc.assetManager.loadBundle("jackpot-win",(n,e)=>{if(n)return console.error(n);const o=h.default.getInstance().getLanguageCode(),a=`textures/${o}`,i=m.AsyncTask(t=>r(this,void 0,void 0,function*(){e.load(["common/sounds/JackpotWinningBGM"],cc.AudioClip,(t,n)=>{u.default.getInstance().addAll(n)}),e.load("common/fonts/SafariBalanceNum",cc.BitmapFont,(t,n)=>{this.labelJackpotWiningPanelAmount.font=n}),e.load(`${a}/GameBonusPic`,cc.SpriteAtlas,(t,n)=>{const e=n.getSpriteFrame("GameBonusBG");this.jackpotWiningBg.spriteFrame=e}),e.load(`animation/${o}/MinorJackpotAnim`,cc.AnimationClip,(t,n)=>{this.minorJackpotAnimation.getComponent(cc.Animation).addClip(n)}),e.load(`animation/${o}/RandomJackpotAnim`,cc.AnimationClip,(t,n)=>{this.randomJackpotAnimation.getComponent(cc.Animation).addClip(n)}),e.load(`animation/${o}/MajorJackpotAnim`,cc.AnimationClip,(t,n)=>{this.majorJackpotAnimation.getComponent(cc.Animation).addClip(n)}),e.load("animation/JackpotWinCoinsParticleAnim",cc.AnimationClip,(n,e)=>{this.coinRainPrefab01.getComponent(cc.Animation).addClip(e),this.coinRainPrefab01.getComponent(cc.Animation).play(e.name),this.coinRainPrefab01.active=!1,t()})}));Promise.all([i]).then(()=>{t()})})})}};i([P(cc.Node)],v.prototype,"jackpotWiningPanel",void 0),i([P(cc.Label)],v.prototype,"labelJackpotWiningPanelAmount",void 0),i([P(cc.Sprite)],v.prototype,"jackpotWiningBg",void 0),i([P(cc.Sprite)],v.prototype,"minorJackpotAnimation",void 0),i([P(cc.Sprite)],v.prototype,"randomJackpotAnimation",void 0),i([P(cc.Sprite)],v.prototype,"majorJackpotAnimation",void 0),i([P(cc.Node)],v.prototype,"coinRainPrefab01",void 0),i([P({tooltip:"Min Jackpot animation Time"})],v.prototype,"minJackpotAnimTime",void 0),i([P({tooltip:"Max Jackpot animation Time"})],v.prototype,"maxJackpotAnimTime",void 0),v=i([g],v),e.default=v,cc._RF.pop()},{"../../../../scripts/HelperTools":void 0,"../../../../scripts/framework/gg":void 0,"../../../../scripts/framework/lib/router/PanelComponent":void 0,"../../../../scripts/manager/AudioManager":void 0,"../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../scripts/manager/EventQueueManager":void 0,"../../../../scripts/manager/GameSystemManager":void 0,"./JackpotPanelEnum":"JackpotPanelEnum","./JackpotPanelModule":"JackpotPanelModule"}]},{},["JackpotCoinRainPrefab","JackpotPanelConst","JackpotPanelEnum","JackpotPanelEvent","JackpotPanelModel","JackpotPanelModule","JackpotPanelPrefab"]);