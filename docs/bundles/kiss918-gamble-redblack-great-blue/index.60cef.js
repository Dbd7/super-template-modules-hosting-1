window.__require=function e(t,a,i){function s(l,o){if(!a[l]){if(!t[l]){var r=l.split("/");if(r=r[r.length-1],!t[r]){var c="function"==typeof __require&&__require;if(!o&&c)return c(r,!0);if(n)return n(r,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){for(var d=l.split("/"),u="",h=d.length;h>0;)d[h]&&".."!=d[h]&&(u="/"+d[h]+u),h--;return r="./assets"+u,__quick_compile_project__.require(r,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+l+"'")}l=r}var p=a[l]={exports:{}};t[l][0].call(p.exports,function(e){return s(t[l][1][e]||e)},p,p.exports,e,t,a,i)}return a[l].exports}for(var n="function"==typeof __require&&__require,l=0;l<i.length;l++)s(i[l]);return s}({Kiss918RedBlackPanelEnum:[function(e,t,a){"use strict";cc._RF.push(t,"dea7f/C1glNT7Atj7KcW05l","Kiss918RedBlackPanelEnum"),Object.defineProperty(a,"__esModule",{value:!0}),a.Kiss918Choices=a.Kiss918Status=void 0,function(e){e[e.Active=1]="Active",e[e.Inactive=0]="Inactive"}(a.Kiss918Status||(a.Kiss918Status={})),function(e){e[e.Red=1]="Red",e[e.Black=2]="Black"}(a.Kiss918Choices||(a.Kiss918Choices={})),cc._RF.pop()},{}],Kiss918RedBlackPanelEvent:[function(e,t){"use strict";cc._RF.push(t,"df86clfu+lAg7ji8ZCzKUVu","Kiss918RedBlackPanelEvent"),cc._RF.pop()},{}],Kiss918RedBlackPanelModel:[function(e,t,a){"use strict";cc._RF.push(t,"8456dRJsPFEGJmjt1UdIAnV","Kiss918RedBlackPanelModel"),Object.defineProperty(a,"__esModule",{value:!0}),a.Kiss918RedBlackPanelModel=void 0,a.Kiss918RedBlackPanelModel=class{constructor(){this.redBlackActive=!1,this.redBlackResult=null,this.lastCardResults=[]}},cc._RF.pop()},{}],Kiss918RedBlackPanelModule:[function(e,t,a){"use strict";cc._RF.push(t,"34b46xjd1dJfKKidj3lRhxb","Kiss918RedBlackPanelModule");var i=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,n){function l(e){try{r(i.next(e))}catch(t){n(t)}}function o(e){try{r(i.throw(e))}catch(t){n(t)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((i=i.apply(e,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const s=e("../../../../../../scripts/HelperTools"),n=e("./Kiss918RedBlackPanelEnum"),l=e("./Kiss918RedBlackPanelModel");class o extends cc.Component{static init(){this.data=new l.Kiss918RedBlackPanelModel}static getRedBlackPanelStatus(){return this.data.redBlackActive}static setRedBlackPanelStatus(e){this.data.redBlackActive=Boolean(e)}static setRedBlackResult(e){this.data.redBlackResult=e}static getLastCardsResults(){return this.data.lastCardResults}static clearRedBlackResult(){this.data.redBlackResult=null,this.data.lastCardResults=[]}static getRedBlackResult(e,t){return i(this,void 0,void 0,function*(){return new Promise(a=>{const i=s.GetRandomInterger(1,52),l=i<=26?n.Kiss918Choices.Black:n.Kiss918Choices.Red;let o=0;e===l&&(o=2*t);const r={cardResult:i,winAmount:o/2,playerBalance:o};this.setRedBlackResult(r),this.addLastCardResult(r.cardResult),a(r)})})}static addLastCardResult(e){this.data.lastCardResults.length>=7&&this.data.lastCardResults.shift(),this.data.lastCardResults.push(e)}}a.default=o,o.data=null,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"./Kiss918RedBlackPanelEnum":"Kiss918RedBlackPanelEnum","./Kiss918RedBlackPanelModel":"Kiss918RedBlackPanelModel"}],Kiss918RedBlackPanelPrefab:[function(e,t,a){"use strict";cc._RF.push(t,"f2333TNAUVDQZcO4qhvUBoK","Kiss918RedBlackPanelPrefab");var i=this&&this.__decorate||function(e,t,a,i){var s,n=arguments.length,l=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,i);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(n<3?s(l):n>3?s(t,a,l):s(t,a))||l);return n>3&&l&&Object.defineProperty(t,a,l),l},s=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,n){function l(e){try{r(i.next(e))}catch(t){n(t)}}function o(e){try{r(i.throw(e))}catch(t){n(t)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((i=i.apply(e,t||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const l=e("../../../../../../scripts/framework/gg"),o=e("../../../../../../scripts/HelperTools"),r=n(e("../../../../../../scripts/manager/AudioManager")),c=e("../../../../../../scripts/manager/CreditCoinConvertorManager"),d=n(e("../../../../../../scripts/manager/GameSystemManager")),u=e("../../../../standardized/kiss918/gamble-button/scripts/Kiss918GambleEvent"),h=e("./Kiss918RedBlackPanelEnum"),p=n(e("./Kiss918RedBlackPanelModule")),{ccclass:g,property:m}=cc._decorator;let R=class extends cc.Component{constructor(){super(...arguments),this.redBlackGroup=null,this.btnCollect=null,this.btnRed=null,this.btnBlack=null,this.labelChooseRedOrBlack=null,this.labelLastCard=null,this.labelYouWin=null,this.labelDealerWin=null,this.labelBank=null,this.labelDoubleTo=null,this.labelWinAmount=null,this.currentResult=null,this.lastResults=null,this.cardAtlas=null,this.mainSpriteAtlas=null,this.playerInfoManager={startAmount:0,accWinAmount:0},this.audioInfo={genClick:"Sfx_ButtonClicks",bgm:"Gamble_BGM",cardAnim:"Gamble_CardShaking",pick:"Gamble_PickCard_Click",win:"Gamble_Pick_WIN",lose:"Gamble_Pick_LOSE"}}onLoad(){this.registerEvent(),this.setupProperty()}start(){return s(this,void 0,void 0,function*(){yield this.loadRedBlackAssets(),this.setupRedBlackModule()})}activeGamblePanel(){this.clearUpPreviousPresentation(),p.default.setRedBlackPanelStatus(h.Kiss918Status.Active),this.redBlackGroup.active=!0,this.playAudio(this.audioInfo.bgm,!0),this.resetBettingUI(),this.HandleTargetNode(this.btnCollect,!0),this.updateLastCardsResult(),this.handleButtonsInteraction(!0)}inActiveRedBlackPanel(){this.stopCardResultAnimation(),this.handleButtonsInteraction(!1),this.stopAudio(this.audioInfo.bgm),l.gg.eventManager.emit(u.Kiss918GamblePanelEvent.Complete,this.playerInfoManager.accWinAmount),p.default.setRedBlackPanelStatus(h.Kiss918Status.Inactive),this.redBlackGroup.active=!1}pickedRed(){return s(this,void 0,void 0,function*(){this.playAudio(this.audioInfo.pick),this.handleButtonsInteraction(!1),this.HandleTargetNode(this.btnCollect,!1);const e=yield this.getRedBlackResult(h.Kiss918Choices.Red);this.showResult(e)})}pickedBlack(){return s(this,void 0,void 0,function*(){this.playAudio(this.audioInfo.pick),this.handleButtonsInteraction(!1),this.HandleTargetNode(this.btnCollect,!1);const e=yield this.getRedBlackResult(h.Kiss918Choices.Black);this.showResult(e)})}collectMoney(){this.playAudio(this.audioInfo.genClick),this.inActiveRedBlackPanel()}showResult(e){return s(this,void 0,void 0,function*(){const t=e.winAmount>0;this.updatePlayerBalance(e.playerBalance),this.updateBettingLabelResult(e),this.updateCurrentCardsResult(e.cardResult),this.updateLastCardsResult(),yield o.Delay(2),this.resetBettingUI(),t?(this.HandleTargetNode(this.btnCollect,!0),this.handleButtonsInteraction(!0)):(this.stopCardResultAnimation(),this.inActiveRedBlackPanel())})}resetBettingUI(){this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!1),this.HandleTargetNode(this.labelDealerWin,!1),this.HandleTargetNode(this.labelWinAmount,!1),this.updateBettingInfomation(0,this.playerInfoManager.accWinAmount),this.playCardResultAnimation()}getRedBlackResult(e){return p.default.getRedBlackResult(e,this.playerInfoManager.accWinAmount)}getCardSpriteFrame(e){return{smallCard:this.cardAtlas.getSpriteFrame("Small_"+o.Pad(e,2)),bigCard:this.cardAtlas.getSpriteFrame("Big_"+o.Pad(e,2))}}clearUpPreviousPresentation(){l.gg.eventManager.emit("HUDPrefab.onWiningLineAndSymbolClear"),l.gg.eventManager.emit("BigWinAnim.OnSpaceOrSpinButtonDown"),r.default.getInstance().stopAll(),this.playAudio(this.audioInfo.genClick)}onReceiveWinAmountUpdateEvent(e){console.warn("Gamble receive: ",e),this.playerInfoManager.startAmount=0,this.playerInfoManager.accWinAmount=0,e<=0?(this.playerInfoManager.startAmount=733,this.playerInfoManager.accWinAmount=733):(this.playerInfoManager.startAmount=e,this.playerInfoManager.accWinAmount=e)}hideGambleButton(){l.gg.eventManager.emit(u.Kiss918GambleButtonEvent.Hide)}updateBettingLabelResult(e){e.winAmount>0?(this.updateBettingInfomation(e.winAmount,e.playerBalance),this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!0),this.HandleTargetNode(this.labelDealerWin,!1),this.HandleTargetNode(this.labelWinAmount,!0),this.playAudio(this.audioInfo.win)):(this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!1),this.HandleTargetNode(this.labelDealerWin,!0),this.HandleTargetNode(this.labelWinAmount,!1),this.playAudio(this.audioInfo.lose))}updateBettingInfomation(e,t){this.labelWinAmount.string=c.CCConvertor(e.toFixed(2)),this.labelBank.string=c.CCConvertor(t.toFixed(2)),this.labelDoubleTo.string=c.CCConvertor((2*t).toFixed(2))}updatePlayerBalance(e){this.playerInfoManager.accWinAmount=e}handleButtonsInteraction(e){this.btnRed.interactable=e,this.btnRed.enabled=e,this.btnBlack.interactable=e,this.btnBlack.enabled=e,this.btnCollect.interactable=e,this.btnCollect.enabled=e}HandleTargetNode(e,t){e&&(e.node.active=t)}updateLastCardsResult(){const e=p.default.getLastCardsResults();for(let t=0,a=e.length;t<a;t++){const a=this.lastResults.children[t],i=e[t],s=this.getCardSpriteFrame(i);a.active=!0,a.getComponent(cc.Sprite).spriteFrame=s.smallCard}}updateCurrentCardsResult(e){this.stopCardResultAnimation();const t=this.getCardSpriteFrame(e);this.currentResult.spriteFrame=t.bigCard}playCardResultAnimation(){this.currentResult.getComponent(cc.Animation).play(),this.playAudio(this.audioInfo.cardAnim,!0)}stopCardResultAnimation(){this.currentResult.getComponent(cc.Animation).stop(),this.stopAudio(this.audioInfo.cardAnim)}playAudio(e,t=!1){e&&r.default.getInstance().play(e,t)}stopAudio(e){e&&r.default.getInstance().stop(e)}registerEvent(){l.gg.eventManager.on("HUDPrefab.onWiningLineAndSymbolClear",this.hideGambleButton,this),l.gg.eventManager.on("SlotEnginePrefab.OnSpinStarted",this.hideGambleButton,this),l.gg.eventManager.on("SlotEnginePrefab.OnSpinStartedByReel",this.hideGambleButton,this),l.gg.eventManager.on(u.Kiss918GamblePanelEvent.UpdateStartingAmount,this.onReceiveWinAmountUpdateEvent,this),l.gg.eventManager.on(u.Kiss918GamblePanelEvent.Start,this.activeGamblePanel,this)}setupRedBlackModule(){p.default.init()}setupProperty(){}loadRedBlackAssets(){return s(this,void 0,void 0,function*(){return new Promise(e=>{cc.assetManager.loadBundle("kiss918-gamble-redblack-great-blue",(t,a)=>{if(t)return console.error(t);const i="/"+d.default.getInstance().getLanguageCode(),n=o.AsyncTask(e=>s(this,void 0,void 0,function*(){let t="textures"+i+"/GambleUI";a.load(t,cc.SpriteAtlas,(e,t)=>{this.mainSpriteAtlas=t,o.UItools.ChangeButtonSpriteFrame(this.btnRed,this.mainSpriteAtlas,{normalSprite:"Red_01",pressedSprite:"Red_02",disabledSprite:"Red_03"}),o.UItools.ChangeButtonSpriteFrame(this.btnBlack,this.mainSpriteAtlas,{normalSprite:"Black_01",pressedSprite:"Black_02",disabledSprite:"Black_03"}),o.UItools.ChangeButtonSpriteFrame(this.btnCollect,this.mainSpriteAtlas,{normalSprite:"Collect_01",pressedSprite:"Collect_02"}),this.labelDealerWin.spriteFrame=t.getSpriteFrame("dealer_wins"),this.labelLastCard.spriteFrame=t.getSpriteFrame("LastCards"),this.labelChooseRedOrBlack.spriteFrame=t.getSpriteFrame("Choose")}),t="common/sounds/",a.load([t+this.audioInfo.bgm,t+this.audioInfo.cardAnim,t+this.audioInfo.pick,t+this.audioInfo.win,t+this.audioInfo.lose],cc.AudioClip,(e,t)=>{for(const a of t)r.default.getInstance().add(a.name,a)}),e()}));Promise.all([n]).then(()=>{e()})})})})}};i([m(cc.Node)],R.prototype,"redBlackGroup",void 0),i([m(cc.Button)],R.prototype,"btnCollect",void 0),i([m(cc.Button)],R.prototype,"btnRed",void 0),i([m(cc.Button)],R.prototype,"btnBlack",void 0),i([m(cc.Sprite)],R.prototype,"labelChooseRedOrBlack",void 0),i([m(cc.Sprite)],R.prototype,"labelLastCard",void 0),i([m(cc.Sprite)],R.prototype,"labelYouWin",void 0),i([m(cc.Sprite)],R.prototype,"labelDealerWin",void 0),i([m(cc.Label)],R.prototype,"labelBank",void 0),i([m(cc.Label)],R.prototype,"labelDoubleTo",void 0),i([m(cc.Label)],R.prototype,"labelWinAmount",void 0),i([m(cc.Sprite)],R.prototype,"currentResult",void 0),i([m(cc.Node)],R.prototype,"lastResults",void 0),i([m(cc.SpriteAtlas)],R.prototype,"cardAtlas",void 0),R=i([g],R),a.default=R,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"../../../../../../scripts/framework/gg":void 0,"../../../../../../scripts/manager/AudioManager":void 0,"../../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../../scripts/manager/GameSystemManager":void 0,"../../../../standardized/kiss918/gamble-button/scripts/Kiss918GambleEvent":void 0,"./Kiss918RedBlackPanelEnum":"Kiss918RedBlackPanelEnum","./Kiss918RedBlackPanelModule":"Kiss918RedBlackPanelModule"}]},{},["Kiss918RedBlackPanelEnum","Kiss918RedBlackPanelEvent","Kiss918RedBlackPanelModel","Kiss918RedBlackPanelModule","Kiss918RedBlackPanelPrefab"]);