window.__require=function e(t,n,i){function o(s,l){if(!n[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var u="function"==typeof __require&&__require;if(!l&&u)return u(r,!0);if(a)return a(r,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){for(var c=s.split("/"),d="",m=c.length;m>0;)c[m]&&".."!=c[m]&&(d="/"+c[m]+d),m--;return r="./assets"+d,__quick_compile_project__.require(r,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+s+"'")}s=r}var p=n[s]={exports:{}};t[s][0].call(p.exports,function(e){return o(t[s][1][e]||e)},p,p.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof __require&&__require,s=0;s<i.length;s++)o(i[s]);return o}({Kiss918CommonCoinPanelConst:[function(e,t,n){"use strict";cc._RF.push(t,"75f1e534sdJD4fVaH6HEnKh","Kiss918CommonCoinPanelConst"),Object.defineProperty(n,"__esModule",{value:!0}),n.Kiss918CommonCoinPanelConst=void 0,n.Kiss918CommonCoinPanelConst={CacheKey:"game.cache"},cc._RF.pop()},{}],Kiss918CommonCoinPanelEnum:[function(e,t,n){"use strict";cc._RF.push(t,"df2c9phMAtNk6Zrh3LbgccS","Kiss918CommonCoinPanelEnum"),Object.defineProperty(n,"__esModule",{value:!0}),n.Kiss918CommonBetType=n.Kiss918CommonStatus=void 0,function(e){e[e.Active=1]="Active",e[e.Inactive=0]="Inactive"}(n.Kiss918CommonStatus||(n.Kiss918CommonStatus={})),function(e){e[e.Head=1]="Head",e[e.Tail=2]="Tail"}(n.Kiss918CommonBetType||(n.Kiss918CommonBetType={})),cc._RF.pop()},{}],Kiss918CommonCoinPanelEvent:[function(e,t,n){"use strict";cc._RF.push(t,"aeed3GlbnRJGoCAvG5OO5Ok","Kiss918CommonCoinPanelEvent"),Object.defineProperty(n,"__esModule",{value:!0}),n.Kiss918CommonCoinPanelEvent=void 0,(n.Kiss918CommonCoinPanelEvent||(n.Kiss918CommonCoinPanelEvent={})).OnResultUpdate="CoinPanelEvent.OnResultUpdate",cc._RF.pop()},{}],Kiss918CommonCoinPanelModel:[function(e,t,n){"use strict";cc._RF.push(t,"816fe/lfiBGQ6Ld7EXOYZnT","Kiss918CommonCoinPanelModel"),Object.defineProperty(n,"__esModule",{value:!0}),n.Kiss918CommonCoinPanelModel=void 0,n.Kiss918CommonCoinPanelModel=class{constructor(){this.coinActive=!1,this.coinResult=null,this.coinMultiplier=[],this.winningStreak=0,this.lastCoinResults=[]}},cc._RF.pop()},{}],Kiss918CommonCoinPanelModule:[function(e,t,n){"use strict";cc._RF.push(t,"473e9CyuUlKtqGRah+CyRRJ","Kiss918CommonCoinPanelModule");var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function s(e){try{r(i.next(e))}catch(t){a(t)}}function l(e){try{r(i.throw(e))}catch(t){a(t)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,l)}r((i=i.apply(e,t||[])).next())})};Object.defineProperty(n,"__esModule",{value:!0});const o=e("../../../../../../scripts/HelperTools"),a=e("./Kiss918CommonCoinPanelEnum"),s=e("./Kiss918CommonCoinPanelModel");class l extends cc.Component{static init(){this.data=new s.Kiss918CommonCoinPanelModel}static getCoinPanelStatus(){return this.data.coinActive}static setCoinPanelStatus(e){this.data.coinActive=Boolean(e)}static setCoinResult(e){this.data.coinResult=e}static getLastCoinResults(){return this.data.lastCoinResults}static clearCoinResult(){this.data.coinResult=null,this.data.lastCoinResults=[]}static getCoinMultiplier(){return this.data.coinMultiplier[this.data.winningStreak]}static getCoinResult(e,t){return i(this,void 0,void 0,function*(){return new Promise(n=>{const i=o.GetRandomInterger(a.Kiss918CommonBetType.Head,a.Kiss918CommonBetType.Tail);let s=0,l=this.data.coinMultiplier[0];if(e===i){const e=cc.misc.clampf(this.data.winningStreak,0,this.data.coinMultiplier.length-1);l=this.data.coinMultiplier[e],s=t*l,this.data.winningStreak=cc.misc.clampf(this.data.winningStreak+1,0,5)}else this.data.winningStreak=0;const r={betType:i,winningStreak:this.data.winningStreak,winAmount:s};this.setCoinResult(r),this.addLastCoinResult(r.betType),n(r)})})}static addLastCoinResult(e){this.data.lastCoinResults.length>=6&&this.data.lastCoinResults.shift(),this.data.lastCoinResults.push(e)}}n.default=l,l.data=null,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"./Kiss918CommonCoinPanelEnum":"Kiss918CommonCoinPanelEnum","./Kiss918CommonCoinPanelModel":"Kiss918CommonCoinPanelModel"}],Kiss918CommonCoinPanelPrefab:[function(e,t,n){"use strict";cc._RF.push(t,"c0879xt1uBACoE/f/jrkc5H","Kiss918CommonCoinPanelPrefab");var i=this&&this.__decorate||function(e,t,n,i){var o,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(s=(a<3?o(s):a>3?o(t,n,s):o(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function s(e){try{r(i.next(e))}catch(t){a(t)}}function l(e){try{r(i.throw(e))}catch(t){a(t)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,l)}r((i=i.apply(e,t||[])).next())})},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const s=e("../../../../../../scripts/framework/lib/router/PanelComponent"),l=e("../../../../../../scripts/HelperTools"),r=a(e("../../../../../../scripts/manager/AudioManager")),u=a(e("../../../../../../scripts/manager/GameSystemManager")),c=e("./Kiss918CommonCoinPanelEnum"),d=a(e("./Kiss918CommonCoinPanelModule")),{ccclass:m,property:p}=cc._decorator;let h=class extends s.PanelComponent{constructor(){super(...arguments),this.coinGroup=null,this.currentCoinResult=null,this.btnTakeWin=null,this.btnTail=null,this.btnHead=null,this.lastResults=null,this.payoutMultiplier=null,this.charactor=null,this.charactorAtlas=null,this.coinAtlas=null,this.coinSound=null,this.gameWinSound=null,this.gameLooseSound=null,this.backgroundMusic=null,this.dummyPlayerBalanceManager={balance:0},this.labelLayer={labelBank:null,labelGambleWon:null,labelMultiplyTo:null},this.headTailSriteFrame={smallCoinHead:null,smallCoinTail:null,bigCoinHead:null,bigCoinTail:null},this.coinResultInitBetType=null}start(){return o(this,void 0,void 0,function*(){yield this.loadAssets(),this.setupCoinModule()})}show(e){e.onShowed()}hide(e){e.onHided()}activeGamblePanel(){return o(this,void 0,void 0,function*(){this.dummyPlayerBalanceManager.balance<=0&&(this.dummyPlayerBalanceManager.balance=13.31),r.default.getInstance().play("ClickSound"),r.default.getInstance().play("CoinBackgroundMusic",!0),this.resetBettingUI(),this.updateLastCoinResult(),this.randomCurrentCoinResultSpriteFrame(),d.default.setCoinPanelStatus(c.Kiss918CommonStatus.Active),this.coinGroup.active=!0})}inActiveGamblePanel(){d.default.setCoinPanelStatus(c.Kiss918CommonStatus.Inactive),this.coinGroup.active=!1,r.default.getInstance().stop("CoinBackgroundMusic")}takeWin(){this.inActiveGamblePanel()}placeBet(e,t){return o(this,void 0,void 0,function*(){r.default.getInstance().play("ClickSound"),this.disableCommonButtons(),this.disableBettingButtons();const e=yield d.default.getCoinResult(Number(t),this.dummyPlayerBalanceManager.balance);yield this.playCoinAnimation(e),yield l.Delay(.1),this.updateLastCoinResult(),this.updateGambleWon(this.dummyPlayerBalanceManager.balance,e.winAmount),this.updateCharacterCostume(e),this.updatePayoutMultiplier(e.winningStreak),this.dummyPlayerBalanceManager.balance=e.winAmount,this.updateBettingInfomation(),this.updateBank(),e.winAmount>0?(yield l.Delay(.25),this.updateBettingUI()):(yield l.Delay(1),this.inActiveGamblePanel())})}updateBettingUI(){this.enableCommonButtons(),this.enableBettingButtons(),this.updateBettingInfomation(),this.updateBank()}resetBettingUI(){this.updateBettingUI(),this.updateGambleWon(0,0),this.updatePayoutMultiplier(0),this.updateCharacterCostume({betType:c.Kiss918CommonBetType.Head,winAmount:1,winningStreak:0})}playCoinAnimation(e){return o(this,void 0,void 0,function*(){yield l.AsyncTask(t=>{r.default.getInstance().play("CoinSound");const n=this.currentCoinResult.getComponent(cc.Animation),i=d.default.getLastCoinResults(),o=i[i.length-1],a=this.getBetTypeName(o),s=i[i.length-2];let l=this.getBetTypeName(s);l||(l=this.coinResultInitBetType===c.Kiss918CommonBetType.Head?"Head":"Tail");const u=l+"To"+a+"Animation";n.play(u),n.once(cc.Animation.EventType.FINISHED,()=>{e.winAmount>0?r.default.getInstance().play("CoinGameWinSound"):r.default.getInstance().play("CoinGameLooseSound"),t()})})})}getBetTypeName(e){return e===c.Kiss918CommonBetType.Head?"Head":e===c.Kiss918CommonBetType.Tail?"Tail":void 0}setupCoinModule(){d.default.init(),d.default.data.coinMultiplier=[2,4,6,8,10,12],this.cacheLabellayer(),this.cacheHeadTailSpriteFrame(),r.default.getInstance().add("CoinSound",this.coinSound),r.default.getInstance().add("CoinGameWinSound",this.gameWinSound),r.default.getInstance().add("CoinGameLooseSound",this.gameLooseSound),r.default.getInstance().add("CoinBackgroundMusic",this.backgroundMusic)}cacheLabellayer(){const e=cc.find("LabelLayer",this.coinGroup);this.labelLayer.labelBank=e.getChildByName("LabelBank").getComponent(cc.Label),this.labelLayer.labelGambleWon=e.getChildByName("LabelGambleWon").getComponent(cc.Label),this.labelLayer.labelMultiplyTo=e.getChildByName("LabelMultiplyTo").getComponent(cc.Label)}cacheHeadTailSpriteFrame(){this.headTailSriteFrame.bigCoinHead=this.coinAtlas.getSpriteFrame("qtoq01"),this.headTailSriteFrame.bigCoinTail=this.coinAtlas.getSpriteFrame("xtox01"),this.headTailSriteFrame.smallCoinHead=this.coinAtlas.getSpriteFrame("hisquan01"),this.headTailSriteFrame.smallCoinTail=this.coinAtlas.getSpriteFrame("hisxing01")}randomCurrentCoinResultSpriteFrame(){if(0===d.default.getLastCoinResults().length){let e=this.headTailSriteFrame.bigCoinHead;this.coinResultInitBetType=c.Kiss918CommonBetType.Head,l.GetRandomInterger(c.Kiss918CommonBetType.Head,c.Kiss918CommonBetType.Tail)===c.Kiss918CommonBetType.Tail&&(e=this.headTailSriteFrame.bigCoinTail,this.coinResultInitBetType=c.Kiss918CommonBetType.Tail),this.currentCoinResult.spriteFrame=e}}getCharactorCostumeSpriteFrame(e){return this.charactorAtlas.getSpriteFrame("dbact0"+e)}enableCommonButtons(){this.btnTakeWin.enabled=!0}disableCommonButtons(){this.btnTakeWin.enabled=!1}enableBettingButtons(){this.btnHead.enabled=!0,this.btnTail.enabled=!0}disableBettingButtons(){this.btnHead.enabled=!1,this.btnTail.enabled=!1}updatePayoutMultiplier(e){for(const t of this.payoutMultiplier.children)t.active=!1;this.payoutMultiplier.children[e].active=!0}updateCharacterCostume(e){if(0===e.winAmount)return;let t=e.winningStreak+1;t=6===t?7:t;const n=this.getCharactorCostumeSpriteFrame(t);this.charactor.spriteFrame=n}updateBettingInfomation(){const e=this.dummyPlayerBalanceManager.balance,t=d.default.getCoinMultiplier();this.labelLayer.labelMultiplyTo.string=l.BeautifyNumber(e*t,2)}updateGambleWon(e,t){this.labelLayer.labelGambleWon.string=0===t?"0.00":l.BeautifyNumber(t-e,2)}updateBank(){this.labelLayer.labelBank.string=l.BeautifyNumber(this.dummyPlayerBalanceManager.balance,2)}updateLastCoinResult(){const e=[...d.default.getLastCoinResults()].reverse();for(let t=0,n=e.length;t<n;t++){const n=this.lastResults.children[t],i=e[t];n.active=!0,i===c.Kiss918CommonBetType.Head?n.getComponent(cc.Sprite).spriteFrame=this.headTailSriteFrame.smallCoinHead:i===c.Kiss918CommonBetType.Tail&&(n.getComponent(cc.Sprite).spriteFrame=this.headTailSriteFrame.smallCoinTail)}}loadAssets(){return o(this,void 0,void 0,function*(){return new Promise(e=>{cc.assetManager.loadBundle("kiss918-gamble-dice",(t,n)=>{if(t)return console.error(t);const i=`textures/${u.default.getInstance().getLanguageCode()}`,a=l.AsyncTask(e=>o(this,void 0,void 0,function*(){n.load(`${i}/bdbg`,cc.SpriteFrame,(t,n)=>{cc.find("SafeArea/CoinGroup/Background",this.node).getComponent(cc.Sprite).spriteFrame=n,e()})}));Promise.all([a]).then(()=>{e()})})})})}};i([p(cc.Node)],h.prototype,"coinGroup",void 0),i([p(cc.Sprite)],h.prototype,"currentCoinResult",void 0),i([p(cc.Button)],h.prototype,"btnTakeWin",void 0),i([p(cc.Button)],h.prototype,"btnTail",void 0),i([p(cc.Button)],h.prototype,"btnHead",void 0),i([p(cc.Node)],h.prototype,"lastResults",void 0),i([p(cc.Node)],h.prototype,"payoutMultiplier",void 0),i([p(cc.Sprite)],h.prototype,"charactor",void 0),i([p(cc.SpriteAtlas)],h.prototype,"charactorAtlas",void 0),i([p(cc.SpriteAtlas)],h.prototype,"coinAtlas",void 0),i([p(cc.AudioClip)],h.prototype,"coinSound",void 0),i([p(cc.AudioClip)],h.prototype,"gameWinSound",void 0),i([p(cc.AudioClip)],h.prototype,"gameLooseSound",void 0),i([p(cc.AudioClip)],h.prototype,"backgroundMusic",void 0),h=i([m],h),n.default=h,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"../../../../../../scripts/framework/lib/router/PanelComponent":void 0,"../../../../../../scripts/manager/AudioManager":void 0,"../../../../../../scripts/manager/GameSystemManager":void 0,"./Kiss918CommonCoinPanelEnum":"Kiss918CommonCoinPanelEnum","./Kiss918CommonCoinPanelModule":"Kiss918CommonCoinPanelModule"}]},{},["Kiss918CommonCoinPanelConst","Kiss918CommonCoinPanelEnum","Kiss918CommonCoinPanelEvent","Kiss918CommonCoinPanelModel","Kiss918CommonCoinPanelModule","Kiss918CommonCoinPanelPrefab"]);