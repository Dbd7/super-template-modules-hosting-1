window.__require=function e(t,a,n){function i(o,r){if(!a[o]){if(!t[o]){var s=o.split("/"),d=s,h=o;if(d=d[d.length-1],s.length>1&&(window.cachePath[d]=o),!t[d]){var c="function"==typeof __require&&__require;if(!r&&c)return c(d,!0);if(l)return l(d,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){var u=window.cachePath[d];u&&(h=u);for(var g=h.split("/"),b="",p=g.length;p>0;)g[p]&&".."!=g[p]&&(b="/"+g[p]+b),p--;return d="./assets"+b,__quick_compile_project__.require(d,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+o+"'")}o=d}var C=a[o]={exports:{}};t[o][0].call(C.exports,function(e){return i(t[o][1][e]||e)},C,C.exports,e,t,a,n)}return a[o].exports}window.cachePath={};for(var l="function"==typeof __require&&__require,o=0;o<n.length;o++)i(n[o]);return i}({HighCardPanelConst_PM:[function(e,t){"use strict";cc._RF.push(t,"537f80NwAJO0qfjamy3uZ66","HighCardPanelConst_PM"),cc._RF.pop()},{}],HighCardPanelEnum_PM:[function(e,t,a){"use strict";cc._RF.push(t,"b2e50ajLYZP74vI2Q0g4Oyd","HighCardPanelEnum_PM"),Object.defineProperty(a,"__esModule",{value:!0}),a.CardType_PM=a.BetType_PM=void 0,function(e){e[e.DoubleHalf=1]="DoubleHalf",e[e.Double=2]="Double"}(a.BetType_PM||(a.BetType_PM={})),function(e){e[e.Spade=4]="Spade",e[e.Heart=3]="Heart",e[e.Club=2]="Club",e[e.Diamond=1]="Diamond"}(a.CardType_PM||(a.CardType_PM={})),cc._RF.pop()},{}],HighCardPanelEvent_PM:[function(e,t,a){"use strict";cc._RF.push(t,"fc2972uPUdLFYH9xnpwEAv3","HighCardPanelEvent_PM"),Object.defineProperty(a,"__esModule",{value:!0}),a.HighCardPanelEvent_PM=void 0,(a.HighCardPanelEvent_PM||(a.HighCardPanelEvent_PM={})).OnResultUpdate="HighCardPanelEvent.OnResultUpdate",cc._RF.pop()},{}],HighCardPanelModel_PM:[function(e,t,a){"use strict";cc._RF.push(t,"307a2LD6/BOxptkzSdqaeng","HighCardPanelModel_PM"),Object.defineProperty(a,"__esModule",{value:!0}),a.HighCardPanelModel_PM=void 0,a.HighCardPanelModel_PM=class{constructor(){this.highCardActive=!1,this.highCardResult=null,this.cardDesk=new Map,this.numbersForRandom=[]}},cc._RF.pop()},{}],HighCardPanelModule_PM:[function(e,t,a){"use strict";cc._RF.push(t,"e9ccc672fNAcoOSJx7n4NLZ","HighCardPanelModule_PM");var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,l){function o(e){try{s(n.next(e))}catch(t){l(t)}}function r(e){try{s(n.throw(e))}catch(t){l(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,r)}s((n=n.apply(e,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const i=e("./HighCardPanelModel_PM"),l=e("./HighCardPanelEnum_PM"),o=e("../../../../../../scripts/HelperTools");class r extends cc.Component{static init(){this.data=new i.HighCardPanelModel_PM,this.addCardToDesk(),this.data.numbersForRandom=this.generateRangeNumber(1,52)}static getHighCardPanelStatus(){return this.data.highCardActive}static setHighCardPanelStatus(e){this.data.highCardActive=e}static clearHighCardResult(){this.data.highCardResult=null}static getHighCardResult(e){return n(this,void 0,void 0,function*(){return new Promise(t=>{const a=o.Shuffle(this.data.numbersForRandom),n=a[0],i=a[1],l=[a[2],a[3],a[4]],r=this.getCardFromDesk(n),s=this.getCardFromDesk(i),d={dealerCard:n,playerCard:i,randomCard:l,winAmount:this.compareCard(r,s)?e:0};this.setHighCardResult(d),t(d)})})}static setHighCardResult(e){this.data.highCardResult=e}static getCardFromDesk(e){return this.data.cardDesk.get(o.Pad(e,2))}static compareCard(e,t){const a=e.cardValue+e.cardType;return t.cardValue+t.cardType>a}static generateRangeNumber(e,t){const a=[];for(let n=e;n<=t;n++)a.push(n);return a}static addCardToDesk(){this.addTargetCardToDeck(0,l.CardType_PM.Spade),this.addTargetCardToDeck(13,l.CardType_PM.Club),this.addTargetCardToDeck(26,l.CardType_PM.Heart),this.addTargetCardToDeck(39,l.CardType_PM.Diamond)}static addTargetCardToDeck(e,t){for(let a=e,n=0;a<13+e;a++,n++)this.data.cardDesk.set(o.Pad(a+1,2),{cardValue:n+2,cardType:t})}}a.default=r,r.data=null,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"./HighCardPanelEnum_PM":"HighCardPanelEnum_PM","./HighCardPanelModel_PM":"HighCardPanelModel_PM"}],HighCardPanelPrefab_PM:[function(e,t,a){"use strict";cc._RF.push(t,"c314cYwpABEEYkYJgarXg1g","HighCardPanelPrefab_PM");var n=this&&this.__decorate||function(e,t,a,n){var i,l=arguments.length,o=l<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,n);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(o=(l<3?i(o):l>3?i(t,a,o):i(t,a))||o);return l>3&&o&&Object.defineProperty(t,a,o),o},i=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,l){function o(e){try{s(n.next(e))}catch(t){l(t)}}function r(e){try{s(n.throw(e))}catch(t){l(t)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(o,r)}s((n=n.apply(e,t||[])).next())})},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const o=e("../../../../../../scripts/framework/gg"),r=e("../../../../../../scripts/framework/lib/router/PanelComponent"),s=e("../../../../../../scripts/HelperTools"),d=l(e("../../../../../../scripts/manager/AudioManager")),h=e("../../../../../../scripts/manager/CreditCoinConvertorManager"),c=l(e("../../../../../../scripts/manager/GameSystemManager")),u=e("../../../../standardized/gamble-button/scripts/GambleButtonEvent"),g=e("./HighCardPanelEnum_PM"),b=l(e("./HighCardPanelModule_PM")),{ccclass:p,property:C}=cc._decorator;let m=class extends r.PanelComponent{constructor(){super(...arguments),this.highCardGroup=null,this.btnCollect=null,this.btnDoubleHalf=null,this.btnDouble=null,this.cardBack=null,this.cardAtlas=null,this.resultCardButton=[],this.dummyPlayerBalanceManager={balance:0},this.labelLayer={labelTotalbet:null,labelWinAmount:null,labelBank:null,labelDoubleHalfTo:null,labelDoubleTo:null},this.messageLayer={labelChooseDouble:null,labelPickAHigherCard:null,labelWin:null},this.mainSpriteAtlas=null,this.audioInfo={genClick:"Sfx_ButtonClicks",bgm:"Sfx_Gamble_BGM",win:"Sfx_Gamble_WIN",lose:"Sfx_Gamble_LOSE"}}onLoad(){this.registerEvent()}start(){return i(this,void 0,void 0,function*(){this.setupHighCardModule(),this.setupButtonCallback(),this.handleCardButtons(!1),yield this.loadGambleAssets()})}show(e){e.onShowed()}hide(e){e.onHided()}activeGamblePanel(){this.clearUpPreviousPresentation(),b.default.setHighCardPanelStatus(!0),this.highCardGroup.active=!0,this.playAudio(this.audioInfo.bgm,!0),this.resetBettingUI(),this.updateBettingInfomation(),this.updateBank()}inActiveHighCardPanel(){b.default.setHighCardPanelStatus(!1),this.highCardGroup.active=!1,this.stopAudio(this.audioInfo.bgm),o.gg.eventManager.emit(u.GamblePanelEvent.Complete,this.dummyPlayerBalanceManager.balance)}collectMoney(){this.inActiveHighCardPanel()}doubleHalfBet(){return i(this,void 0,void 0,function*(){this.playAudio(this.audioInfo.genClick),this.handleCommonButtons(!1),this.updateTotalBet(g.BetType_PM.DoubleHalf);const e=yield b.default.getHighCardResult(Number(this.labelLayer.labelDoubleHalfTo.string));this.showDealerCard(e),this.handleCardButtons(!0)})}doubleBet(){return i(this,void 0,void 0,function*(){this.playAudio(this.audioInfo.genClick),this.handleCommonButtons(!1),this.updateTotalBet(g.BetType_PM.Double);const e=yield b.default.getHighCardResult(Number(this.labelLayer.labelDoubleTo.string));this.showDealerCard(e),this.handleCardButtons(!0)})}playerPickCard(e,t){return i(this,void 0,void 0,function*(){this.playAudio(this.audioInfo.genClick),this.handleCardButtons(!1);const e=Object.assign({},b.default.data.highCardResult),a=this.getCardSpriteFrame(e.playerCard),n=this.resultCardButton[t];n.normalSprite=a.bigCard,n.node.getChildByName("Label").active=!0,e.winAmount>0?(this.dummyPlayerBalanceManager.balance=e.winAmount,this.labelLayer.labelWinAmount.string=h.CCConvertor(e.winAmount.toFixed(2)),this.labelLayer.labelWinAmount.node.active=!0,this.playAudio(this.audioInfo.win)):(this.dummyPlayerBalanceManager.balance=e.winAmount,this.playAudio(this.audioInfo.lose)),this.handleMessageLabel(!1,!1,e.winAmount>0),yield s.Delay(1);for(let i=1;i<=4;i++){if(i===t)continue;const a=this.getCardSpriteFrame(e.randomCard.pop()),n=this.resultCardButton[i];n.normalSprite=a.bigCard,n.node.getChildByName("LoseShader").active=!0,yield s.Delay(.5)}yield s.Delay(2),e.winAmount>0?this.resetBettingUI():this.inActiveHighCardPanel()})}resetBettingUI(){for(let e=0;e<this.resultCardButton.length;e++){const t=this.resultCardButton[e];t.node.getChildByName("Label").active=0===e,t.node.getChildByName("LoseShader").active=!1}this.handleMessageLabel(!0,!1,!1),this.labelLayer.labelBank.node.active=!0,this.labelLayer.labelDoubleHalfTo.node.active=!0,this.labelLayer.labelDoubleTo.node.active=!0,this.labelLayer.labelWinAmount.node.active=!1,this.handleCardButtons(!1),this.handleCommonButtons(!0),this.updateBettingInfomation(),this.updateBank()}showDealerCard(e){const t=this.getCardSpriteFrame(e.dealerCard),a=this.resultCardButton[0];a.normalSprite=t.bigCard,a.node.getChildByName("Label").active=!0,this.handleCardButtons(!0),this.handleMessageLabel(!1,!0,!1)}handleCommonButtons(e){this.btnCollect.node.active=e,this.btnDouble.node.active=e,this.btnDoubleHalf.node.active=e}handleCardButtons(e){for(const t of this.resultCardButton)t.enabled=e}handleMessageLabel(e,t,a){this.messageLayer.labelChooseDouble.node.active=e,this.messageLayer.labelPickAHigherCard.node.active=t,this.messageLayer.labelWin.node.active=a}getCardSpriteFrame(e){return{smallCard:this.cardAtlas.getSpriteFrame("Small_"+s.Pad(e,2)),bigCard:this.cardAtlas.getSpriteFrame("Big_"+s.Pad(e,2))}}updateBettingInfomation(){const e=this.dummyPlayerBalanceManager.balance;this.labelLayer.labelTotalbet.string="",this.labelLayer.labelDoubleHalfTo.string=h.CCConvertor((e/2+e).toFixed(2)),this.labelLayer.labelDoubleTo.string=h.CCConvertor((2*e).toFixed(2))}updateTotalBet(e){const t=this.dummyPlayerBalanceManager.balance;let a=0;e===g.BetType_PM.DoubleHalf?(a=s.RoundUp(t/2,2),this.labelLayer.labelDoubleTo.node.active=!1):e===g.BetType_PM.Double&&(a=t,this.labelLayer.labelBank.node.active=!1,this.labelLayer.labelDoubleHalfTo.node.active=!1),this.labelLayer.labelTotalbet.string=h.CCConvertor(a.toFixed(2)),this.dummyPlayerBalanceManager.balance=s.RoundDown(t-a,2),this.updateBank()}updateBank(){this.labelLayer.labelBank.string=h.CCConvertor(this.dummyPlayerBalanceManager.balance.toFixed(2))}hideGambleButton(){o.gg.eventManager.emit(u.GambleButtonEvent.Hide)}onReceiveWinAmountUpdateEvent(e){if(console.log("Gamble receive: ",e),e<=0){const e=91.01;this.dummyPlayerBalanceManager.balance=e}else this.dummyPlayerBalanceManager.balance=e}clearUpPreviousPresentation(){o.gg.eventManager.emit("HUDPrefab.onWiningLineAndSymbolClear"),d.default.getInstance().stopAll(),this.playAudio(this.audioInfo.genClick)}playAudio(e,t=!1){e&&d.default.getInstance().play(e,t)}stopAudio(e){e&&d.default.getInstance().stop(e)}registerEvent(){o.gg.eventManager.on("HUDPrefab.onWiningLineAndSymbolClear",this.hideGambleButton,this),o.gg.eventManager.on("SlotEnginePrefab.OnSpinStarted",this.hideGambleButton,this),o.gg.eventManager.on("SlotEnginePrefab.OnSpinStartedByReel",this.hideGambleButton,this),o.gg.eventManager.on(u.GamblePanelEvent.UpdateStartingAmount,this.onReceiveWinAmountUpdateEvent,this),o.gg.eventManager.on(u.GamblePanelEvent.Start,this.activeGamblePanel,this)}setupButtonCallback(){this.btnCollect.node.on("click",()=>{this.collectMoney()}),this.btnDoubleHalf.node.on("click",()=>{this.doubleHalfBet()}),this.btnDouble.node.on("click",()=>{this.doubleBet()})}setupHighCardModule(){b.default.init(),this.cacheResultCards(),this.cacheMessagelayer(),this.cacheLabellayer()}cacheResultCards(){const e=cc.find("Results/Cards",this.highCardGroup).children;for(let t=0;t<e.length;t++){const a=e[t].getComponent(cc.Button);a.node.on("click",()=>{this.playerPickCard(null,t)}),this.resultCardButton.push(a)}}cacheMessagelayer(){const e=cc.find("Results/MessageLayer",this.highCardGroup);this.messageLayer.labelChooseDouble=e.getChildByName("LabelChooseDouble").getComponent(cc.Sprite),this.messageLayer.labelPickAHigherCard=e.getChildByName("LabelPickAHigherCard").getComponent(cc.Sprite),this.messageLayer.labelWin=e.getChildByName("LabelWin").getComponent(cc.Sprite)}cacheLabellayer(){const e=cc.find("LabelLayer",this.highCardGroup);this.labelLayer.labelTotalbet=e.getChildByName("LabelTotalbet").getComponent(cc.Label),this.labelLayer.labelWinAmount=e.getChildByName("LabelWinAmount").getComponent(cc.Label),this.labelLayer.labelBank=e.getChildByName("LabelBank").getComponent(cc.Label),this.labelLayer.labelDoubleHalfTo=e.getChildByName("LabelDoubleHalfTo").getComponent(cc.Label),this.labelLayer.labelDoubleTo=e.getChildByName("LabelDoubleTo").getComponent(cc.Label)}changeSpriteFrame(e,t){const a=this.mainSpriteAtlas.getSpriteFrame(t);e&&a&&(e.spriteFrame=a)}changeButtonSprite(e,t){e&&s.UItools.ChangeButtonSpriteFrame(e,this.mainSpriteAtlas,{normalSprite:t+"_01",pressedSprite:t+"_02",disabledSprite:t+"_03"})}loadGambleAssets(){return i(this,void 0,void 0,function*(){return new Promise(e=>{cc.assetManager.loadBundle("kiss918-gamble-highcard-panther-moon",(t,a)=>{if(t)return console.error(t);const n=c.default.getInstance().getLanguageCode(),l=s.AsyncTask(e=>i(this,void 0,void 0,function*(){const t="textures/"+n+"/GambleUI";a.load(t,cc.SpriteAtlas,(e,t)=>{this.mainSpriteAtlas=t,this.changeButtonSprite(this.btnCollect,"Colledt"),this.changeButtonSprite(this.btnDoubleHalf,"DoubleHalf"),this.changeButtonSprite(this.btnDouble,"Double");for(let n=0;n<this.resultCardButton.length;n++){const e=this.resultCardButton[n].node.getChildByName("Label").getComponent(cc.Sprite);0===n?this.changeSpriteFrame(e,"Dealer"):this.changeSpriteFrame(e,"Player")}const a=this.highCardGroup.getChildByName("Background").getComponent(cc.Sprite);this.changeSpriteFrame(a,"BigSmallBg.jpg"),this.changeSpriteFrame(this.messageLayer.labelChooseDouble,"Prompt_02"),this.changeSpriteFrame(this.messageLayer.labelPickAHigherCard,"Prompt_03"),this.changeSpriteFrame(this.messageLayer.labelWin,"Prompt_04")}),a.load(["common/sounds/"+this.audioInfo.bgm,"common/sounds/"+this.audioInfo.win,"common/sounds/"+this.audioInfo.lose],cc.AudioClip,(e,t)=>{for(const a of t)d.default.getInstance().add(a.name,a)}),e()}));Promise.all([l]).then(()=>{e()})})})})}};n([C(cc.Node)],m.prototype,"highCardGroup",void 0),n([C(cc.Button)],m.prototype,"btnCollect",void 0),n([C(cc.Button)],m.prototype,"btnDoubleHalf",void 0),n([C(cc.Button)],m.prototype,"btnDouble",void 0),n([C(cc.SpriteFrame)],m.prototype,"cardBack",void 0),n([C(cc.SpriteAtlas)],m.prototype,"cardAtlas",void 0),m=n([p],m),a.default=m,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"../../../../../../scripts/framework/gg":void 0,"../../../../../../scripts/framework/lib/router/PanelComponent":void 0,"../../../../../../scripts/manager/AudioManager":void 0,"../../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../../scripts/manager/GameSystemManager":void 0,"../../../../standardized/gamble-button/scripts/GambleButtonEvent":void 0,"./HighCardPanelEnum_PM":"HighCardPanelEnum_PM","./HighCardPanelModule_PM":"HighCardPanelModule_PM"}]},{},["HighCardPanelConst_PM","HighCardPanelEnum_PM","HighCardPanelEvent_PM","HighCardPanelModel_PM","HighCardPanelModule_PM","HighCardPanelPrefab_PM"]);