window.__require=function e(t,a,n){function i(l,o){if(!a[l]){if(!t[l]){var r=l.split("/"),c=r,d=l;if(c=c[c.length-1],r.length>1&&(window.cachePath[c]=l),!t[c]){var u="function"==typeof __require&&__require;if(!o&&u)return u(c,!0);if(s)return s(c,!0);if("object"==typeof __quick_compile_project__&&__quick_compile_project__){var h=window.cachePath[c];h&&(d=h);for(var p=d.split("/"),g="",f=p.length;f>0;)p[f]&&".."!=p[f]&&(g="/"+p[f]+g),f--;return c="./assets"+g,__quick_compile_project__.require(c,"preview-scripts/__qc_index__.js")}throw new Error("Cannot find module '"+l+"'")}l=c}var b=a[l]={exports:{}};t[l][0].call(b.exports,function(e){return i(t[l][1][e]||e)},b,b.exports,e,t,a,n)}return a[l].exports}window.cachePath={};for(var s="function"==typeof __require&&__require,l=0;l<n.length;l++)i(n[l]);return i}({Kiss918RedBlackPanelEnum_ET:[function(e,t,a){"use strict";cc._RF.push(t,"d62f6m31VpO77ybq+IWwbMg","Kiss918RedBlackPanelEnum_ET"),Object.defineProperty(a,"__esModule",{value:!0}),a.Kiss918Choices_ET=void 0,function(e){e[e.Red=1]="Red",e[e.Black=2]="Black"}(a.Kiss918Choices_ET||(a.Kiss918Choices_ET={})),cc._RF.pop()},{}],Kiss918RedBlackPanelEvent_ET:[function(e,t){"use strict";cc._RF.push(t,"02f8chFjetDnIGzVPAzQZZf","Kiss918RedBlackPanelEvent_ET"),cc._RF.pop()},{}],Kiss918RedBlackPanelModel_ET:[function(e,t,a){"use strict";cc._RF.push(t,"2fd09W4vTBDj4ia6vlBPwEz","Kiss918RedBlackPanelModel_ET"),Object.defineProperty(a,"__esModule",{value:!0}),a.Kiss918RedBlackPanelModel_ET=void 0,a.Kiss918RedBlackPanelModel_ET=class{constructor(){this.redBlackActive=!1,this.redBlackResult=null,this.lastCardResults=[]}},cc._RF.pop()},{}],Kiss918RedBlackPanelModule_ET:[function(e,t,a){"use strict";cc._RF.push(t,"ea038XU9TdBpKiRcrYzn2rU","Kiss918RedBlackPanelModule_ET");var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,s){function l(e){try{r(n.next(e))}catch(t){s(t)}}function o(e){try{r(n.throw(e))}catch(t){s(t)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((n=n.apply(e,t||[])).next())})};Object.defineProperty(a,"__esModule",{value:!0});const i=e("../../../../../../scripts/HelperTools"),s=e("./Kiss918RedBlackPanelEnum_ET"),l=e("./Kiss918RedBlackPanelModel_ET");class o extends cc.Component{static init(){this.data=new l.Kiss918RedBlackPanelModel_ET}static getRedBlackPanelStatus(){return this.data.redBlackActive}static setRedBlackPanelStatus(e){this.data.redBlackActive=e}static setRedBlackResult(e){this.data.redBlackResult=e}static getLastCardsResults(){return this.data.lastCardResults}static clearRedBlackResult(){this.data.redBlackResult=null,this.data.lastCardResults=[]}static getRedBlackResult(e,t){return n(this,void 0,void 0,function*(){return new Promise(a=>{const n=i.GetRandomInterger(1,52),l=n<=26?s.Kiss918Choices_ET.Black:s.Kiss918Choices_ET.Red;let o=0;e===l&&(o=2*t);const r={cardResult:n,winAmount:o/2,playerBalance:o};this.setRedBlackResult(r),this.addLastCardResult(r.cardResult),a(r)})})}static addLastCardResult(e){this.data.lastCardResults.length>=5&&this.data.lastCardResults.shift(),this.data.lastCardResults.push(e)}}a.default=o,o.data=null,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"./Kiss918RedBlackPanelEnum_ET":"Kiss918RedBlackPanelEnum_ET","./Kiss918RedBlackPanelModel_ET":"Kiss918RedBlackPanelModel_ET"}],Kiss918RedBlackPanelPrefab_ET:[function(e,t,a){"use strict";cc._RF.push(t,"66195zxZi1MtIU/L9N1FmNN","Kiss918RedBlackPanelPrefab_ET");var n=this&&this.__decorate||function(e,t,a,n){var i,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,a,n);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(l=(s<3?i(l):s>3?i(t,a,l):i(t,a))||l);return s>3&&l&&Object.defineProperty(t,a,l),l},i=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))(function(i,s){function l(e){try{r(n.next(e))}catch(t){s(t)}}function o(e){try{r(n.throw(e))}catch(t){s(t)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(l,o)}r((n=n.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});const l=e("../../../../../../scripts/framework/gg"),o=e("../../../../../../scripts/HelperTools"),r=s(e("../../../../../../scripts/manager/AudioManager")),c=e("../../../../../../scripts/manager/CreditCoinConvertorManager"),d=s(e("../../../../../../scripts/manager/GameSystemManager")),u=e("../../../../standardized/gamble-button/scripts/GambleButtonEvent"),h=e("./Kiss918RedBlackPanelEnum_ET"),p=s(e("./Kiss918RedBlackPanelModule_ET")),{ccclass:g,property:f}=cc._decorator;let b=class extends cc.Component{constructor(){super(...arguments),this.redBlackGroup=null,this.btnCollect=null,this.btnRed=null,this.btnBlack=null,this.labelChooseRedOrBlack=null,this.labelYouWin=null,this.labelDealerWin=null,this.labelBank=null,this.labelDoubleTo=null,this.labelWinAmount=null,this.currentResult=null,this.lastResults=null,this.cardAtlas=null,this.hasLocalise=!0,this.mainSpriteAtlas=null,this.playerInfoManager={factorValue:0,played:!1},this.betInfoManager={win:0,bet:0,double:0},this.audioInfo={genClick:"Sfx_ButtonClicks",bgm:"Sfx_Gamble_BGM",cardAnim:"Sfx_Gamble_CardShake",pick:"Sfx_Gamble_PickCard_Click",win:"Sfx_Gamble_WIN",lose:"Sfx_Gamble_LOSE"}}onLoad(){this.registerEvent(),this.setupProperty()}start(){return i(this,void 0,void 0,function*(){this.setupRedBlackModule(),yield this.loadRedBlackAssets()})}activeGamblePanel(){this.clearUpPreviousPresentation(),p.default.setRedBlackPanelStatus(!0),this.redBlackGroup.active=!0,this.playAudio(this.audioInfo.bgm,!0),this.resetBettingUI(),this.HandleTargetNode(this.btnCollect,!0),this.updateLastCardsResult(),this.handleButtonsInteraction(!0)}inActiveRedBlackPanel(){this.stopCardResultAnimation(),this.handleButtonsInteraction(!1),this.stopAudio(this.audioInfo.bgm),l.gg.eventManager.emit(u.GamblePanelEvent.Complete,this.finalWinAmount),p.default.setRedBlackPanelStatus(!1),this.redBlackGroup.active=!1}pickedRed(){return i(this,void 0,void 0,function*(){this.playCardClickSFX(),this.handleButtonsInteraction(!1),this.HandleTargetNode(this.btnCollect,!1);const e=yield this.getRedBlackResult(h.Kiss918Choices_ET.Red);this.showResult(e)})}pickedBlack(){return i(this,void 0,void 0,function*(){this.playCardClickSFX(),this.handleButtonsInteraction(!1),this.HandleTargetNode(this.btnCollect,!1);const e=yield this.getRedBlackResult(h.Kiss918Choices_ET.Black);this.showResult(e)})}collectMoney(){this.playAudio(this.audioInfo.genClick),this.inActiveRedBlackPanel()}showResult(e){return i(this,void 0,void 0,function*(){const t=e.winAmount>0;this.updatePlayerInfoManager(e.winAmount),t&&this.updateBetInfoManager(e.winAmount,2*e.winAmount),this.updateBettingLabelResult(e),this.updateCurrentCardsResult(e.cardResult),this.updateLastCardsResult(),yield o.Delay(2),this.resetBettingUI(),t?(this.HandleTargetNode(this.btnCollect,!0),this.handleButtonsInteraction(!0)):(this.stopCardResultAnimation(),this.inActiveRedBlackPanel())})}getRedBlackResult(e){return p.default.getRedBlackResult(e,this.betAmount)}clearUpPreviousPresentation(){l.gg.eventManager.emit("HUDPrefab.onWiningLineAndSymbolClear"),r.default.getInstance().stopAll(),this.playAudio(this.audioInfo.genClick)}get factorValue(){return this.playerInfoManager.factorValue}get finalWinAmount(){let e=0;return e=this.playerInfoManager.played?this.betAmount*this.factorValue:0,console.warn("Gamble return: ",e),e}updatePlayerInfoManager(e){this.playerInfoManager.played=!0,this.playerInfoManager.factorValue=e>0?1:-1}reseETlayerInfoManager(){this.playerInfoManager={factorValue:1,played:!1}}get betWinAmount(){return this.betInfoManager.win}get betAmount(){return this.betInfoManager.bet}get doubleBetAmount(){return this.betInfoManager.double}updateBetInfoManager(e,t){this.betInfoManager.win+=e,this.betInfoManager.bet=t,this.betInfoManager.double=2*t}resetBetInfoManager(){this.betInfoManager={win:0,bet:0,double:0}}onReceiveWinAmountUpdateEvent(e){if(console.warn("Gamble receive: ",e),this.reseETlayerInfoManager(),this.resetBetInfoManager(),-1===e){const e=5;this.updateBetInfoManager(0,e)}else this.updateBetInfoManager(0,e)}hideGambleButton(){l.gg.eventManager.emit(u.GambleButtonEvent.Hide)}updateBettingLabelResult(e){e.winAmount>0?(this.updateBettingInfomation(),this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!0),this.HandleTargetNode(this.labelDealerWin,!1),this.HandleTargetNode(this.labelWinAmount,!0),this.playAudio(this.audioInfo.win)):(this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!1),this.HandleTargetNode(this.labelDealerWin,!0),this.HandleTargetNode(this.labelWinAmount,!1),this.playAudio(this.audioInfo.lose))}updateBettingInfomation(){this.labelWinAmount&&(this.labelWinAmount.string=c.CCConvertor(this.betWinAmount.toFixed(2))),this.labelBank&&(this.labelBank.string=c.CCConvertor(this.betAmount.toFixed(2))),this.labelDoubleTo&&(this.labelDoubleTo.string=c.CCConvertor(this.doubleBetAmount.toFixed(2)))}resetBettingUI(){this.HandleTargetNode(this.labelChooseRedOrBlack,!0),this.HandleTargetNode(this.labelYouWin,!1),this.HandleTargetNode(this.labelDealerWin,!1),this.HandleTargetNode(this.labelWinAmount,!1),this.updateBettingInfomation(),this.playCardResultAnimation()}handleButtonsInteraction(e){this.btnRed.interactable=e,this.btnRed.enabled=e,this.btnBlack.interactable=e,this.btnBlack.enabled=e,this.btnCollect.interactable=e,this.btnCollect.enabled=e}HandleTargetNode(e,t){e&&(e.node.active=t)}updateLastCardsResult(){const e=p.default.getLastCardsResults();for(let t=0,a=e.length;t<a;t++){const a=this.lastResults.children[t],n=e[t],i=this.getCardSpriteFrame(n);a.active=!0,a.getComponent(cc.Sprite).spriteFrame=i.smallCard}}updateCurrentCardsResult(e){this.stopCardResultAnimation();const t=this.getCardSpriteFrame(e);this.currentResult.spriteFrame=t.bigCard}getCardSpriteFrame(e){const t=this.cardAtlas.getSpriteFrame("Poker_"+o.Pad(e,2));return{smallCard:t,bigCard:t}}playCardResultAnimation(){this.currentResult.getComponent(cc.Animation).play(),this.playAudio(this.audioInfo.cardAnim,!0)}stopCardResultAnimation(){this.currentResult.getComponent(cc.Animation).stop(),this.stopAudio(this.audioInfo.cardAnim)}playCardClickSFX(){this.playAudio(this.audioInfo.pick?this.audioInfo.pick:this.audioInfo.genClick)}playAudio(e,t=!1){e&&r.default.getInstance().play(e,t)}stopAudio(e){e&&r.default.getInstance().stop(e)}registerEvent(){l.gg.eventManager.on("HUDPrefab.onWiningLineAndSymbolClear",this.hideGambleButton,this),l.gg.eventManager.on("SlotEnginePrefab.OnSpinStarted",this.hideGambleButton,this),l.gg.eventManager.on("SlotEnginePrefab.OnSpinStartedByReel",this.hideGambleButton,this),l.gg.eventManager.on(u.GamblePanelEvent.UpdateStartingAmount,this.onReceiveWinAmountUpdateEvent,this),l.gg.eventManager.on(u.GamblePanelEvent.Start,this.activeGamblePanel,this)}setupRedBlackModule(){p.default.init()}setupProperty(){this.registerButtonCallback(this.btnRed,()=>{this.pickedRed()}),this.registerButtonCallback(this.btnBlack,()=>{this.pickedBlack()}),this.registerButtonCallback(this.btnCollect,()=>{this.collectMoney()}),this.redBlackGroup.active&&(this.redBlackGroup.active=!1)}registerButtonCallback(e,t){e.node.on("click",t)}changeSpriteFrame(e,t){const a=this.mainSpriteAtlas.getSpriteFrame(t);e&&a&&(e.spriteFrame=a)}changeButtonSprite(e,t){e&&o.UItools.ChangeButtonSpriteFrame(e,this.mainSpriteAtlas,{normalSprite:t+"_01",pressedSprite:t+"_02",disabledSprite:t+"_03"})}getAllAudioPath(){const e=[];return this.audioInfo.bgm&&e.push("common/sounds/"+this.audioInfo.bgm),this.audioInfo.pick&&e.push("common/sounds/"+this.audioInfo.pick),this.audioInfo.cardAnim&&e.push("common/sounds/"+this.audioInfo.cardAnim),this.audioInfo.win&&e.push("common/sounds/"+this.audioInfo.win),this.audioInfo.lose&&e.push("common/sounds/"+this.audioInfo.lose),e}loadRedBlackAssets(){return i(this,void 0,void 0,function*(){return new Promise(e=>{cc.assetManager.loadBundle("kiss918-gamble-redblack-easter",(t,a)=>{if(t)return console.error(t);const n=d.default.getInstance().getLanguageCode(),s=o.AsyncTask(e=>i(this,void 0,void 0,function*(){if(this.hasLocalise){const e="textures/"+n+"/GambleUI";a.load(e,cc.SpriteAtlas,(e,t)=>{e&&console.error(e),this.mainSpriteAtlas=t,this.changeButtonSprite(this.btnRed,"BtnRed"),this.changeButtonSprite(this.btnBlack,"BtnBlack"),this.changeButtonSprite(this.btnCollect,"BtnTack");const a=this.labelChooseRedOrBlack.node.parent.getChildByName("LabelBank").getComponent(cc.Sprite),n=this.labelChooseRedOrBlack.node.parent.getChildByName("LabelBank").getComponent(cc.Sprite);this.changeSpriteFrame(this.labelChooseRedOrBlack,"SelectBg"),this.changeSpriteFrame(a,"DoubleBetBg"),this.changeSpriteFrame(n,"DoubleBg_02")})}a.load(this.getAllAudioPath(),cc.AudioClip,(e,t)=>{e&&console.error(e);for(const a of t)r.default.getInstance().add(a.name,a)}),e()}));Promise.all([s]).then(()=>{e()})})})})}};n([f(cc.Node)],b.prototype,"redBlackGroup",void 0),n([f(cc.Button)],b.prototype,"btnCollect",void 0),n([f(cc.Button)],b.prototype,"btnRed",void 0),n([f(cc.Button)],b.prototype,"btnBlack",void 0),n([f(cc.Sprite)],b.prototype,"labelChooseRedOrBlack",void 0),n([f(cc.Sprite)],b.prototype,"labelYouWin",void 0),n([f(cc.Sprite)],b.prototype,"labelDealerWin",void 0),n([f(cc.Label)],b.prototype,"labelBank",void 0),n([f(cc.Label)],b.prototype,"labelDoubleTo",void 0),n([f(cc.Label)],b.prototype,"labelWinAmount",void 0),n([f(cc.Sprite)],b.prototype,"currentResult",void 0),n([f(cc.Node)],b.prototype,"lastResults",void 0),n([f(cc.SpriteAtlas)],b.prototype,"cardAtlas",void 0),n([f()],b.prototype,"hasLocalise",void 0),b=n([g],b),a.default=b,cc._RF.pop()},{"../../../../../../scripts/HelperTools":void 0,"../../../../../../scripts/framework/gg":void 0,"../../../../../../scripts/manager/AudioManager":void 0,"../../../../../../scripts/manager/CreditCoinConvertorManager":void 0,"../../../../../../scripts/manager/GameSystemManager":void 0,"../../../../standardized/gamble-button/scripts/GambleButtonEvent":void 0,"./Kiss918RedBlackPanelEnum_ET":"Kiss918RedBlackPanelEnum_ET","./Kiss918RedBlackPanelModule_ET":"Kiss918RedBlackPanelModule_ET"}]},{},["Kiss918RedBlackPanelEnum_ET","Kiss918RedBlackPanelEvent_ET","Kiss918RedBlackPanelModel_ET","Kiss918RedBlackPanelModule_ET","Kiss918RedBlackPanelPrefab_ET"]);